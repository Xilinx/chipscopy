<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>chipscopy.api.ddr.ddr &mdash; ChipScoPy 2024.1.1717697699 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../index.html" class="icon icon-home"> ChipScoPy
          </a>
              <div class="version">
                2024.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../overview.html">ChipScoPy Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chipscopy_installation.html">ChipScoPy Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev_setup.html">Developer Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ChipScoPy Debug Core API Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../ddr.html">DDR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ibert.html">IBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ila.html">ILA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../memory.html">Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../noc.html">NocPerfmon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pcie.html">PCIe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sysmon.html">SysMon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../vio.html">VIO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc Classes &amp; Utility Functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../containers.html">Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../device.html">Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../report.html">Report</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../session.html">Session</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ChipScoPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
          <li><a href="../../api.html">chipscopy.api</a> &raquo;</li>
      <li>chipscopy.api.ddr.ddr</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for chipscopy.api.ddr.ddr</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2021-2022, Xilinx, Inc.</span>
<span class="c1"># Copyright (C) 2022-2023, Advanced Micro Devices, Inc.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

    <span class="n">_plotting_pkgs_available</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_plotting_pkgs_available</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">get_ipython</span>
    <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>

    <span class="n">_jupyter_available</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">get_ipython</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Image</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">display</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_jupyter_available</span> <span class="o">=</span> <span class="kc">False</span>

<span class="kn">from</span> <span class="nn">chipscopy.dm</span> <span class="kn">import</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">chipscopy.tcf.services</span> <span class="kn">import</span> <span class="n">DoneHWCommand</span>
<span class="kn">from</span> <span class="nn">chipscopy.api</span> <span class="kn">import</span> <span class="n">CoreType</span>
<span class="kn">from</span> <span class="nn">chipscopy.api._detail.debug_core</span> <span class="kn">import</span> <span class="n">DebugCore</span>
<span class="kn">from</span> <span class="nn">chipscopy.utils.printer</span> <span class="kn">import</span> <span class="n">PercentProgressBar</span><span class="p">,</span> <span class="n">printer</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">chipscopy.client.ddrmc_client</span> <span class="kn">import</span> <span class="n">DDRMCClient</span>


<div class="viewcode-block" id="DDR"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DDR</span><span class="p">(</span><span class="n">DebugCore</span><span class="p">[</span><span class="s2">&quot;DDRMCClient&quot;</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class contains the top level API functions to interact with the</span>
<span class="sd">    integrated DDR memory controller debug core(s) on Versal devices.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ddr_node</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DDR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">CoreType</span><span class="o">.</span><span class="n">DDR</span><span class="p">,</span> <span class="n">ddr_node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="n">ddr_node</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_index</span> <span class="o">=</span> <span class="n">ddr_node</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;mc_index&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_loc</span> <span class="o">=</span> <span class="n">ddr_node</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;mc_loc&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ddr_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_tcf_node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_user_enabled</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">arch_type</span> <span class="o">=</span> <span class="n">ddr_node</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;arch&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arch_type</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arch_type</span> <span class="o">==</span> <span class="s2">&quot;gen5&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">crypto_en</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">crypto_type</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__get_crypto_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_by</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;mc_index&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_index</span><span class="p">,</span> <span class="s2">&quot;mc_loc&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_loc</span><span class="p">}</span>

<div class="viewcode-block" id="DDR.get_cal_status"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.get_cal_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_cal_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the main calibration status of DDRMC</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>
<span class="sd">            status in string</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_cal_status</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="DDR.refresh_cal_status"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.refresh_cal_status">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_cal_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">done</span><span class="p">:</span> <span class="n">DoneHWCommand</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh the main calibration status of DDRMC</span>

<span class="sd">        Args:</span>
<span class="sd">            done: Optional command callback that will be invoked when the response is received</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">refresh_cal_status</span><span class="p">(</span><span class="n">done</span><span class="p">)</span></div>

<div class="viewcode-block" id="DDR.get_cal_stages"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.get_cal_stages">[docs]</a>    <span class="k">def</span> <span class="nf">get_cal_stages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the decoded calibration stages results happened from a</span>
<span class="sd">        calibration run</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary where</span>
<span class="sd">                Key = calibration stage name</span>
<span class="sd">                Val = stage calibration result</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property_group</span><span class="p">([</span><span class="s2">&quot;stages&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="DDR.refresh_cal_margin"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.refresh_cal_margin">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_cal_margin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">done</span><span class="p">:</span> <span class="n">DoneHWCommand</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh the calibration windows margin analysis of DDRMC</span>

<span class="sd">        Args:</span>
<span class="sd">            done: Optional command callback that will be invoked when the response is received</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">refresh_cal_margin</span><span class="p">(</span><span class="n">done</span><span class="p">)</span></div>

<div class="viewcode-block" id="DDR.refresh_health_status"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.refresh_health_status">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_health_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">done</span><span class="p">:</span> <span class="n">DoneHWCommand</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh the overall health status analysis of DDRMC</span>

<span class="sd">        Args:</span>
<span class="sd">            done: Optional command callback that will be invoked when the response is received</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">refresh_health_status</span><span class="p">(</span><span class="n">done</span><span class="p">)</span></div>

<div class="viewcode-block" id="DDR.get_cal_margin_mode"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.get_cal_margin_mode">[docs]</a>    <span class="k">def</span> <span class="nf">get_cal_margin_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the availability of windows margin mode generated from a</span>
<span class="sd">        calibration run</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary where</span>
<span class="sd">                Key = name of margin mode</span>
<span class="sd">                Val = True or False value indicating the availability</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_cal_margin_mode</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="DDR.is_user_enabled"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.is_user_enabled">[docs]</a>    <span class="k">def</span> <span class="nf">is_user_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find out whether the DDRMC core is user enabled or not after</span>
<span class="sd">        Versal device configuration</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>
<span class="sd">            Status value in Bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if not being powered by NoC clock, it is automatically disabled</span>
        <span class="n">clock_off</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">is_clock_gated</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">clock_off</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;pcsr_control_ub_init&quot;</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="DDR.get_property"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.get_property">[docs]</a>    <span class="k">def</span> <span class="nf">get_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">property_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">done</span><span class="p">:</span> <span class="n">DoneHWCommand</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the property value mapped to DDRMC core</span>

<span class="sd">        Args:</span>
<span class="sd">            property_names: single string or list of string of property names</span>
<span class="sd">                (if None specified, all properties available will be queried and returned)</span>

<span class="sd">            done: Optional command callback that will be invoked when the response is received</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary, where</span>
<span class="sd">                Key = property name</span>
<span class="sd">                Val = property value</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="n">property_names</span><span class="p">,</span> <span class="n">done</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

    <span class="k">def</span> <span class="nf">__get_crypto_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Only care if it is Gen5 and User enabled</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_enabled</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">props</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;crypto_en&quot;</span><span class="p">,</span> <span class="s2">&quot;crypto_status&quot;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;crypto_en&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crypto_en</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">crypto_type</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;crypto_status&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__get_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">is_lrdimm</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;DDRMC Core Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;mem_type&quot;</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mem_type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Memory Interface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DDR4&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Memory Interface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LPDDR4&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Memory Interface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DDR5&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Memory Interface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LPDDR5&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Memory Interface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;dimm_type&quot;</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;dimm_type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Device Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Component&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Device Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;UDIMM&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Device Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RDIMM&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Device Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LRDIMM&quot;</span>
            <span class="n">is_lrdimm</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Device Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>

        <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;MC Location&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_loc</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;slots&quot;</span><span class="p">)</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;slots&quot;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;phy_ranks&quot;</span><span class="p">)</span>
        <span class="n">phy_ranks</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;phy_ranks&quot;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;mem_ranks&quot;</span><span class="p">)</span>
        <span class="n">mem_ranks</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mem_ranks&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">is_lrdimm</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Slots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">phy_ranks</span><span class="p">)</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Ranks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mem_ranks</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Slots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Ranks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">phy_ranks</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;bytes&quot;</span><span class="p">)</span>
        <span class="nb">bytes</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;bytes&quot;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;nibbles&quot;</span><span class="p">)</span>
        <span class="n">nibbles</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;nibbles&quot;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;bits_per_byte&quot;</span><span class="p">)</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;bits_per_byte&quot;</span><span class="p">]</span>
        <span class="n">data_width</span> <span class="o">=</span> <span class="nb">bytes</span> <span class="o">*</span> <span class="n">bits</span>
        <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Data Width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_width</span><span class="p">)</span>
        <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Bytes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
        <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Nibbles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nibbles</span><span class="p">)</span>
        <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Bits per Byte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>

        <span class="n">freq_zero</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>
        <span class="n">freq_one</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;dual_freq_en&quot;</span><span class="p">)</span>
        <span class="n">dual_freq</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;dual_freq_en&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span><span class="p">:</span>
            <span class="n">f0_ck_name</span> <span class="o">=</span> <span class="s2">&quot;f0_ck_period&quot;</span>
            <span class="n">f1_ck_name</span> <span class="o">=</span> <span class="s2">&quot;f1_ck_period&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f0_ck_name</span> <span class="o">=</span> <span class="s2">&quot;f0_period&quot;</span>
            <span class="n">f1_ck_name</span> <span class="o">=</span> <span class="s2">&quot;f1_period&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="n">f0_ck_name</span><span class="p">)</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">f0_ck_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">period</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">period</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="n">freq0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1000000</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">freq_zero</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq0</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; MHz&quot;</span>
        <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Memory Frequency 0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq_zero</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">dual_freq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="n">f1_ck_name</span><span class="p">)</span>
            <span class="n">period</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">f1_ck_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">period</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">period</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
                <span class="n">freq1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1000000</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="n">freq_one</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; MHz&quot;</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Memory Frequency 1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq_one</span>

        <span class="k">return</span> <span class="n">configs</span>

    <span class="k">def</span> <span class="nf">__get_cal_margins</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">mode_base</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">left_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">right_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">centers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">prbs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
        <span class="n">group_name</span> <span class="o">=</span> <span class="n">mode_base</span> <span class="o">+</span> <span class="s2">&quot;_left&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property_group</span><span class="p">([</span><span class="n">group_name</span><span class="p">])</span>
        <span class="n">left_margs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">left_margs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="n">group_name</span> <span class="o">=</span> <span class="n">mode_base</span> <span class="o">+</span> <span class="s2">&quot;_right&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property_group</span><span class="p">([</span><span class="n">group_name</span><span class="p">])</span>
        <span class="n">right_margs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">right_margs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="n">centers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prbs</span><span class="p">:</span>
            <span class="n">group_name</span> <span class="o">=</span> <span class="n">mode_base</span> <span class="o">+</span> <span class="s2">&quot;_center&quot;</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property_group</span><span class="p">([</span><span class="n">group_name</span><span class="p">])</span>
            <span class="n">centers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__output_read_margins</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">by_8_mode</span><span class="p">,</span>
        <span class="nb">bytes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">nibbles</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">left_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">right_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">centers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">left_marg_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">left_margs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">center_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">centers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">right_marg_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">right_margs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">by_8_mode</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
                <span class="n">left_marg</span> <span class="o">=</span> <span class="n">left_marg_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">center_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">right_marg</span> <span class="o">=</span> <span class="n">right_marg_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">printer</span><span class="p">(</span>
                    <span class="s2">&quot;Byte &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">byte</span><span class="p">),</span>
                    <span class="s2">&quot; Nibble 0  -&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;  Left Margin:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)  Center Point:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)  Right Margin:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">left_marg</span> <span class="o">=</span> <span class="n">left_marg_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">center_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">right_marg</span> <span class="o">=</span> <span class="n">right_marg_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">printer</span><span class="p">(</span>
                    <span class="s2">&quot;Byte &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">byte</span><span class="p">),</span>
                    <span class="s2">&quot; Nibble 1  -&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;  Left Margin:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)  Center Point:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)  Right Margin:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">nibble</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nibbles</span><span class="p">):</span>
                <span class="n">left_marg</span> <span class="o">=</span> <span class="n">left_marg_vals</span><span class="p">[</span><span class="n">nibble</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">center_vals</span><span class="p">[</span><span class="n">nibble</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">right_marg</span> <span class="o">=</span> <span class="n">right_marg_vals</span><span class="p">[</span><span class="n">nibble</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">printer</span><span class="p">(</span>
                    <span class="s2">&quot;Nibble &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">nibble</span><span class="p">),</span>
                    <span class="s2">&quot;  -&quot;</span> <span class="s2">&quot;  Left Margin:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)  Center Point:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)  Right Margin:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)&quot;</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__output_gen5_margins</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">is_dq</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="nb">bytes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">bits_byte</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">left_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">right_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">centers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">left_marg_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">left_margs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">right_marg_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">right_margs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">center_vals</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">centers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">left_margs</span><span class="p">)):</span>
                <span class="n">center_vals</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">center_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">centers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">is_dq</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bits_byte</span><span class="p">):</span>
                    <span class="n">left_marg</span> <span class="o">=</span> <span class="n">left_marg_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="n">bits_byte</span> <span class="o">+</span> <span class="n">bit</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">center</span> <span class="o">=</span> <span class="n">center_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="n">bits_byte</span> <span class="o">+</span> <span class="n">bit</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">right_marg</span> <span class="o">=</span> <span class="n">right_marg_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="n">bits_byte</span> <span class="o">+</span> <span class="n">bit</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">printer</span><span class="p">(</span>
                        <span class="s2">&quot;Byte &quot;</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">byte</span><span class="p">),</span>
                        <span class="s2">&quot; Bit &quot;</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">bit</span><span class="p">),</span>
                        <span class="s2">&quot; - Left Margin: &quot;</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="s2">&quot;(&quot;</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="s2">&quot;) Center Point: &quot;</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="s2">&quot;(&quot;</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="s2">&quot;) Right Margin: &quot;</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="s2">&quot;(&quot;</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="s2">&quot;)&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># DBI for LP5 Read</span>
            <span class="c1"># DM for Write</span>
            <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
                <span class="n">left_marg</span> <span class="o">=</span> <span class="n">left_marg_vals</span><span class="p">[</span><span class="n">byte</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">center_vals</span><span class="p">[</span><span class="n">byte</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">right_marg</span> <span class="o">=</span> <span class="n">right_marg_vals</span><span class="p">[</span><span class="n">byte</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">printer</span><span class="p">(</span>
                    <span class="s2">&quot;Byte &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">byte</span><span class="p">),</span>
                    <span class="s2">&quot; - Left Margin: &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot;(&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;) Center Point: &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot;(&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;) Right Margin: &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot;(&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)&quot;</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__output_write_margins</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">left_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">right_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">centers</span><span class="p">:</span> <span class="n">Dict</span>
    <span class="p">):</span>
        <span class="n">left_marg_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">left_margs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">center_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">centers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">right_marg_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">right_margs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
            <span class="n">left_marg</span> <span class="o">=</span> <span class="n">left_marg_vals</span><span class="p">[</span><span class="n">byte</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">center_vals</span><span class="p">[</span><span class="n">byte</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">right_marg</span> <span class="o">=</span> <span class="n">right_marg_vals</span><span class="p">[</span><span class="n">byte</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">printer</span><span class="p">(</span>
                <span class="s2">&quot;Byte &quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">byte</span><span class="p">),</span>
                <span class="s2">&quot;  -&quot;</span> <span class="s2">&quot;  Left Margin:  &quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="s2">&quot;)  Center Point:  &quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="s2">&quot;)  Right Margin:  &quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="s2">&quot;)&quot;</span><span class="p">,</span>
            <span class="p">)</span>

<div class="viewcode-block" id="DDR.report"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run a report on the current statuses and analytical data of the DDRMC</span>

<span class="sd">        Args:</span>
<span class="sd">            to_file: specify True to have the report saved to a file</span>

<span class="sd">            file_name: the file name or full path for the report file to be saved</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">orig_out</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">to_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">file_name</span><span class="p">:</span>
                <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">NOTE: Need to specify a file name for the report output.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
                <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">NOTE: The report is being generated and saved as:&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
                <span class="n">orig_out</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">out_file</span>

        <span class="c1"># DDRMC Status &amp; Message</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;-------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot; DDRMC Status </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;-------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># User enabled status check</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_enabled</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;is not enabled.&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">out_file</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">orig_out</span>
                <span class="n">out_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_cal_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_health_status</span><span class="p">()</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;Calibration Status:  &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cal_status</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;health_status&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;Overall Health:  &quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;health_status&quot;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;Crypto Status:  &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crypto_type</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;cal_message&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;Message:  &quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cal_message&quot;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Check if there is error condition to report</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;cal_error_msg&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cal_error_msg&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;Error:  &quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cal_error_msg&quot;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># DDRMC ISR Registers</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot; Status Registers</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;-------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;DDRMC ISR Table</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property_group</span><span class="p">([</span><span class="s2">&quot;ddrmc_isr_e&quot;</span><span class="p">,</span> <span class="s2">&quot;ddrmc_isr_w&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;:  &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">UB ISR Table</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property_group</span><span class="p">([</span><span class="s2">&quot;ub_isr_e&quot;</span><span class="p">,</span> <span class="s2">&quot;ub_isr_w&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;:  &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

        <span class="c1"># Memory configuration info</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">----------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot; Memory Configuration </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;----------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_configuration</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">configs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">printer</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;:  &quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1"># Memory calibration stages info</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-----------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot; Calibration Stages Information </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;-----------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Do not do calibration stages if a system error is detected</span>
        <span class="n">sys_error</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cal_status</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;SYSTEM ERROR&quot;</span><span class="p">:</span>
            <span class="n">sys_error</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sys_error</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cal_stages</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">printer</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;:  &quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Note: DDRMC system error is detected. Calibration stages decoding will not be provided for &quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Cal Margin Analysis</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">---------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot; Calibration Window Margin Analysis </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;---------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sys_error</span><span class="p">:</span>
            <span class="n">cal_margin_modes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">left_margins</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">right_margins</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">center_points</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">cal_margin_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cal_margin_mode</span><span class="p">()</span>
            <span class="n">num_byte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Bytes&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span><span class="p">:</span>
                <span class="n">is_by_8</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">num_nibble</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Nibbles&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_cal_margin</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Bits per Byte&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">is_by_8</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># Main loop to go through dual frequencies</span>
                <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;Frequency &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
                    <span class="c1"># Read Simple</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_simp&quot;</span>
                    <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                        <span class="c1"># Rising Edge</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                            <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_rise&quot;</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                        <span class="p">)</span>
                        <span class="n">printer</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">base</span><span class="p">,</span>
                            <span class="s2">&quot; - Read Margin - Simple Pattern - Rising Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__output_read_margins</span><span class="p">(</span>
                            <span class="n">is_by_8</span><span class="p">,</span>
                            <span class="n">num_byte</span><span class="p">,</span>
                            <span class="n">num_nibble</span><span class="p">,</span>
                            <span class="n">left_margins</span><span class="p">,</span>
                            <span class="n">right_margins</span><span class="p">,</span>
                            <span class="n">center_points</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="c1"># Falling Edge</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                            <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_fall&quot;</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                        <span class="p">)</span>
                        <span class="n">printer</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">base</span><span class="p">,</span>
                            <span class="s2">&quot; - Read Margin - Simple Pattern - Falling Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__output_read_margins</span><span class="p">(</span>
                            <span class="n">is_by_8</span><span class="p">,</span>
                            <span class="n">num_byte</span><span class="p">,</span>
                            <span class="n">num_nibble</span><span class="p">,</span>
                            <span class="n">left_margins</span><span class="p">,</span>
                            <span class="n">right_margins</span><span class="p">,</span>
                            <span class="n">center_points</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="c1"># Read Complex</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_comp&quot;</span>
                    <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                        <span class="c1"># Rising Edge</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                            <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_rise&quot;</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                        <span class="p">)</span>
                        <span class="n">printer</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">base</span><span class="p">,</span>
                            <span class="s2">&quot; - Read Margin - Complex Pattern - Rising Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__output_read_margins</span><span class="p">(</span>
                            <span class="n">is_by_8</span><span class="p">,</span>
                            <span class="n">num_byte</span><span class="p">,</span>
                            <span class="n">num_nibble</span><span class="p">,</span>
                            <span class="n">left_margins</span><span class="p">,</span>
                            <span class="n">right_margins</span><span class="p">,</span>
                            <span class="n">center_points</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="c1"># Falling Edge</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                            <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_fall&quot;</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                        <span class="p">)</span>
                        <span class="n">printer</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">base</span><span class="p">,</span>
                            <span class="s2">&quot; - Read Margin - Complex Pattern - Falling Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__output_read_margins</span><span class="p">(</span>
                            <span class="n">is_by_8</span><span class="p">,</span>
                            <span class="n">num_byte</span><span class="p">,</span>
                            <span class="n">num_nibble</span><span class="p">,</span>
                            <span class="n">left_margins</span><span class="p">,</span>
                            <span class="n">right_margins</span><span class="p">,</span>
                            <span class="n">center_points</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="c1"># Write Simple</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_simp&quot;</span>
                    <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span><span class="p">)</span>
                        <span class="n">printer</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">base</span><span class="p">,</span>
                            <span class="s2">&quot; - Write Margin - Simple Pattern - Calibration Window in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__output_write_margins</span><span class="p">(</span>
                            <span class="n">num_byte</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                        <span class="p">)</span>
                    <span class="c1"># Write Complex</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_comp&quot;</span>
                    <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span><span class="p">)</span>
                        <span class="n">printer</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">base</span><span class="p">,</span>
                            <span class="s2">&quot; - Write Margin - Complex Pattern - Calibration Window in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__output_write_margins</span><span class="p">(</span>
                            <span class="n">num_byte</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                        <span class="p">)</span>
            <span class="c1"># Is Gen5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dual_freqs</span> <span class="o">=</span> <span class="n">configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Memory Frequency 1&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dual_freqs</span><span class="p">:</span>
                    <span class="n">num_freqs</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">num_freqs</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">num_ranks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Ranks&quot;</span><span class="p">])</span>
                <span class="n">num_bits_byte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Bits per Byte&quot;</span><span class="p">])</span>
                <span class="n">prbs_ctps_rise</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">prbs_ctps_fall</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">prbs_ctps</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="c1"># Main loop to go through dual frequencies</span>
                <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_freqs</span><span class="p">):</span>
                    <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;Freq &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Rank &quot;</span>
                    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_ranks</span><span class="p">):</span>
                        <span class="c1"># Read DQ Simp</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dq_simp&quot;</span>
                        <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="c1"># Rising Edge</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dq_simp_rise&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                            <span class="p">)</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Read DQ Margin - Simple Pattern - Rising Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">True</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps_rise</span> <span class="o">=</span> <span class="n">center_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                            <span class="c1"># Falling Edge</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dq_simp_fall&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                            <span class="p">)</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Read DQ Margin - Simple Pattern - Falling Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">True</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps_fall</span> <span class="o">=</span> <span class="n">center_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                        <span class="c1"># Read DQ Comp</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dq_comp&quot;</span>
                        <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="c1"># Rising Edge</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dq_comp_rise&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                            <span class="p">)</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Read DQ Margin - Complex Pattern - Rising Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">True</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps_rise</span> <span class="o">=</span> <span class="n">center_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                            <span class="c1"># Falling Edge</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dq_comp_fall&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                            <span class="p">)</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Read DQ Margin - Complex Pattern - Falling Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">True</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps_fall</span> <span class="o">=</span> <span class="n">center_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                        <span class="c1"># Read DQ PRBS</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dq_prbs&quot;</span>
                        <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="c1"># Rising Edge</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dq_prbs_rise&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span><span class="p">,</span> <span class="kc">True</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">prbs_ctps_rise</span><span class="p">:</span>
                                <span class="n">center_points</span> <span class="o">=</span> <span class="n">prbs_ctps_rise</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Read DQ Margin - PRBS Pattern - Rising Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">True</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps_rise</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

                            <span class="c1"># Falling Edge</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dq_prbs_fall&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span><span class="p">,</span> <span class="kc">True</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">prbs_ctps_fall</span><span class="p">:</span>
                                <span class="n">center_points</span> <span class="o">=</span> <span class="n">prbs_ctps_fall</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Read DQ Margin - PRBS Pattern - Falling Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">True</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps_fall</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

                        <span class="c1"># Read DBI Simp</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dbi_simp&quot;</span>
                        <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="c1"># Rising Edge</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dbi_simp_rise&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                            <span class="p">)</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Read DBI Margin - Simple Pattern - Rising Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">False</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps_rise</span> <span class="o">=</span> <span class="n">center_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                            <span class="c1"># Falling Edge</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dbi_simp_fall&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                            <span class="p">)</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Read DBI Margin - Simple Pattern - Falling Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">False</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps_fall</span> <span class="o">=</span> <span class="n">center_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                        <span class="c1"># Read DBI Comp</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dbi_comp&quot;</span>
                        <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="c1"># Rising Edge</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dbi_comp_rise&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                            <span class="p">)</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Read DBI Margin - Complex Pattern - Rising Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">False</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps_rise</span> <span class="o">=</span> <span class="n">center_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                            <span class="c1"># Falling Edge</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dbi_comp_fall&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                            <span class="p">)</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Read DBI Margin - Complex Pattern - Falling Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">False</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps_fall</span> <span class="o">=</span> <span class="n">center_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                        <span class="c1"># Read DBI PRBS</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dbi_prbs&quot;</span>
                        <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="c1"># Rising Edge</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dbi_prbs_rise&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span><span class="p">,</span> <span class="kc">True</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">prbs_ctps_rise</span><span class="p">:</span>
                                <span class="n">center_points</span> <span class="o">=</span> <span class="n">prbs_ctps_rise</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Read DBI Margin - PRBS Pattern - Rising Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">False</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps_rise</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

                            <span class="c1"># Falling Edge</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_dbi_prbs_fall&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span><span class="p">,</span> <span class="kc">True</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">prbs_ctps_fall</span><span class="p">:</span>
                                <span class="n">center_points</span> <span class="o">=</span> <span class="n">prbs_ctps_fall</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Read DBI Margin - PRBS Pattern - Falling Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">False</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps_fall</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

                        <span class="c1"># Write DQ Simp</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_dq_simp&quot;</span>
                        <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_dq_simp&quot;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                            <span class="p">)</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Write DQ Margin - Simple Pattern - In pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">True</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps</span> <span class="o">=</span> <span class="n">center_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                        <span class="c1"># Write DQ Comp</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_dq_comp&quot;</span>
                        <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_dq_comp&quot;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                            <span class="p">)</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Write DQ Margin - Complex Pattern - In pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">True</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps</span> <span class="o">=</span> <span class="n">center_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                        <span class="c1"># Write DQ PRBS</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_dq_prbs&quot;</span>
                        <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_dq_prbs&quot;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span><span class="p">,</span> <span class="kc">True</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">prbs_ctps</span><span class="p">:</span>
                                <span class="n">center_points</span> <span class="o">=</span> <span class="n">prbs_ctps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Write DQ Margin - PRBS Pattern - In pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">True</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

                        <span class="c1"># Write DM Simp</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_dm_simp&quot;</span>
                        <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_dm_simp&quot;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                            <span class="p">)</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Write DM Margin - Simple Pattern - In pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">False</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps</span> <span class="o">=</span> <span class="n">center_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                        <span class="c1"># Write DM Comp</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_dm_comp&quot;</span>
                        <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_dm_comp&quot;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                            <span class="p">)</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Write DM Margin - Complex Pattern - In pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">False</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">prbs_ctps</span> <span class="o">=</span> <span class="n">center_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                        <span class="c1"># Write DM PRBS</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_dm_prbs&quot;</span>
                        <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="n">group_name_base</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_dm_prbs&quot;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                                <span class="n">group_name_base</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span><span class="p">,</span> <span class="kc">True</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">prbs_ctps</span><span class="p">:</span>
                                <span class="n">center_points</span> <span class="o">=</span> <span class="n">prbs_ctps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="n">printer</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">base</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span>
                                <span class="s2">&quot; - Write DM Margin - PRBS Pattern - In pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__output_gen5_margins</span><span class="p">(</span>
                                <span class="kc">False</span><span class="p">,</span>
                                <span class="n">num_byte</span><span class="p">,</span>
                                <span class="n">num_bits_byte</span><span class="p">,</span>
                                <span class="n">left_margins</span><span class="p">,</span>
                                <span class="n">right_margins</span><span class="p">,</span>
                                <span class="n">center_points</span><span class="p">,</span>
                            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Note: DDRMC system error is detected. Margin Analysis will not be provided for &quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">out_file</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">orig_out</span>
            <span class="n">out_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_read_mode"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.set_eye_scan_read_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_read_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan to read mode</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">commit_property_group</span><span class="p">([])</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_write_mode"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.set_eye_scan_write_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_write_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan to write mode</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">commit_property_group</span><span class="p">([])</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_simple_pattern"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.set_eye_scan_simple_pattern">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_simple_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan traffic pattern to simple mode</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;mgchk_pattern_mode&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">commit_property_group</span><span class="p">([])</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_complex_pattern"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.set_eye_scan_complex_pattern">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_complex_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan traffic pattern to complex mode</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;mgchk_pattern_mode&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">commit_property_group</span><span class="p">([])</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="DDR.select_eye_scan_prbs_pattern"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.select_eye_scan_prbs_pattern">[docs]</a>    <span class="k">def</span> <span class="nf">select_eye_scan_prbs_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">choice</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select 2D eye scan traffic pattern to specific PRBS modes.</span>

<span class="sd">        Args:</span>

<span class="sd">            choice:</span>
<span class="sd">                Choice number valid between 0 and 2 only and corrosponding to following pattern:</span>
<span class="sd">                    0) PRBS 23</span>
<span class="sd">                    1) PRBS 10</span>
<span class="sd">                    2) PRBS 7</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">choice</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: Please enter an integer value from 0 to 2 for PRBS pattern selection.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">choice</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot enter a choice number larger than 2.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">decoded_pattern_choice</span> <span class="o">=</span> <span class="n">choice</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;mgchk_pattern_mode&quot;</span><span class="p">:</span> <span class="n">decoded_pattern_choice</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">commit_property_group</span><span class="p">([])</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_rank"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.set_eye_scan_rank">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rank_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the target rank number on the DDR for 2D eye scan to run on.</span>
<span class="sd">        There will be 4 total possible rank selections. For single slot designs, there will be quad ranks.</span>
<span class="sd">        For dual slot designs, there will be dual ranks per slot.</span>
<span class="sd">        2D Margin Scan can only be performed on one rank at a time, and not in parallel.</span>

<span class="sd">        Args:</span>

<span class="sd">            rank_num:</span>
<span class="sd">                Rank number valid between 0 and 3 on the DDR for 2D Margin to be run on.</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rank_num</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: Please enter an integer value from 0 to 3 for Slot/Rank selection.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">rank_num</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot enter a rank_num value larger than 3.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;mgchk_rank&quot;</span><span class="p">:</span> <span class="n">rank_num</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">commit_property_group</span><span class="p">([])</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="DDR.get_eye_scan_default_read_vref"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.get_eye_scan_default_read_vref">[docs]</a>    <span class="k">def</span> <span class="nf">get_eye_scan_default_read_vref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A helper function for Gen5 DDRMC designs for querying default Read VRef value used</span>
<span class="sd">        during Calibration, in encoded format for control registers (not in percentage format).</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>

<span class="sd">            A calculated value of default Read VRef done during Calibration</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;mgchk_def_rd_vref_h1p_lsb&quot;</span><span class="p">,</span> <span class="s2">&quot;mgchk_def_rd_vref_h1p_msb&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">vref_lower</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mgchk_def_rd_vref_h1p_lsb&quot;</span><span class="p">]</span>
        <span class="n">vref_upper</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mgchk_def_rd_vref_h1p_msb&quot;</span><span class="p">]</span>
        <span class="n">vref_value</span> <span class="o">=</span> <span class="n">vref_lower</span>

        <span class="k">if</span> <span class="n">vref_upper</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">vref_value</span> <span class="o">+=</span> <span class="mi">512</span>

        <span class="k">return</span> <span class="n">vref_value</span></div>

<div class="viewcode-block" id="DDR.get_eye_scan_default_write_vref"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.get_eye_scan_default_write_vref">[docs]</a>    <span class="k">def</span> <span class="nf">get_eye_scan_default_write_vref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A helper function for Gen5 DDRMC designs for querying default Write VRef value used</span>
<span class="sd">        during Calibration, in encoded format for control registers (not in percentage format).</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>

<span class="sd">            A calculated value of default Write VRef done during Calibration</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">([</span><span class="s2">&quot;mgchk_def_wr_vref&quot;</span><span class="p">])</span>
        <span class="n">vref_value</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mgchk_def_wr_vref&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">vref_value</span></div>

<div class="viewcode-block" id="DDR.get_eye_scan_vref_percentage"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.get_eye_scan_vref_percentage">[docs]</a>    <span class="k">def</span> <span class="nf">get_eye_scan_vref_percentage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A user helper function that takes in an encoding vref value intended for the margin scan,</span>
<span class="sd">        and converts it into a percentage value based on the current scan mode</span>
<span class="sd">        and memory configuration detected from the current hardware.</span>

<span class="sd">        Args:</span>

<span class="sd">            vref:</span>
<span class="sd">                For Read mode, valid integer range between 0 to 1023</span>
<span class="sd">                For Write mode, valid integer range between 0 to 50</span>

<span class="sd">        Returns:</span>

<span class="sd">            A translated percentage number in floating point</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vref</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: Please re-enter an integer value for Vref.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">vref</span> <span class="o">&gt;</span> <span class="mi">1023</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot enter VRef values larger than 1023&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">base_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">incr_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ddr4_range_one</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="n">ddr4_range_two</span> <span class="o">=</span> <span class="mi">45</span>
        <span class="n">lp4_range_one</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">lp4_range_two</span> <span class="o">=</span> <span class="mf">20.4</span>
        <span class="n">ddr4_incr_size</span> <span class="o">=</span> <span class="mf">0.65</span>
        <span class="n">lp4_incr_size</span> <span class="o">=</span> <span class="mf">0.4</span>
        <span class="n">lp5_base</span> <span class="o">=</span> <span class="mf">10.0</span>
        <span class="n">lp5_incr_size</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">read_incr_size</span> <span class="o">=</span> <span class="mf">0.0976563</span>
        <span class="n">prop_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Gen5 Write Vref</span>
        <span class="n">vref_threshold</span> <span class="o">=</span> <span class="mi">128</span>

        <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">)</span>
        <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;mem_type&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span><span class="p">:</span>
            <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;mgchk_def_wr_vref_range&quot;</span><span class="p">)</span>
            <span class="n">vref_threshold</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="n">prop_list</span><span class="p">)</span>
        <span class="n">rw_mode</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">]</span>
        <span class="n">mem_type</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mem_type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span><span class="p">:</span>
            <span class="n">write_vref_range</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mgchk_def_wr_vref_range&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rw_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vref</span> <span class="o">&gt;</span> <span class="n">vref_threshold</span><span class="p">:</span>
                <span class="n">printer</span><span class="p">(</span>
                    <span class="s2">&quot;ERROR: Cannot enter Vref values larger than &quot;</span><span class="p">,</span>
                    <span class="n">vref_threshold</span><span class="p">,</span>
                    <span class="s2">&quot; for Write Margin mode&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">mem_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">write_vref_range</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">base_value</span> <span class="o">=</span> <span class="n">ddr4_range_one</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">base_value</span> <span class="o">=</span> <span class="n">ddr4_range_two</span>
                <span class="n">incr_size</span> <span class="o">=</span> <span class="n">ddr4_incr_size</span>
            <span class="k">elif</span> <span class="n">mem_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">write_vref_range</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">base_value</span> <span class="o">=</span> <span class="n">lp4_range_one</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">base_value</span> <span class="o">=</span> <span class="n">lp4_range_two</span>
                <span class="n">incr_size</span> <span class="o">=</span> <span class="n">lp4_incr_size</span>
            <span class="k">elif</span> <span class="n">mem_type</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">base_value</span> <span class="o">=</span> <span class="n">lp5_base</span>
                <span class="n">incr_size</span> <span class="o">=</span> <span class="n">lp5_incr_size</span>
            <span class="k">elif</span> <span class="n">mem_type</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="c1"># This needs to be finalized later</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">incr_size</span> <span class="o">=</span> <span class="n">read_incr_size</span>

        <span class="n">offset_value</span> <span class="o">=</span> <span class="n">vref</span> <span class="o">*</span> <span class="n">incr_size</span>
        <span class="n">output_vref</span> <span class="o">=</span> <span class="n">base_value</span> <span class="o">+</span> <span class="n">offset_value</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rw_mode</span><span class="p">:</span>
            <span class="n">output_vref</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">output_vref</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_vref</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">output_vref</span>

        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">output_vref</span><span class="p">)</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_vref_min"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.set_eye_scan_vref_min">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_vref_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan desired minimum vref value to scan</span>

<span class="sd">        Args:</span>

<span class="sd">            vref:</span>
<span class="sd">                For Read mode, valid integer range between 0 to 1023</span>
<span class="sd">                For Write mode, valid integer range between 0 to 50</span>

<span class="sd">        Returns:</span>

<span class="sd">            A translated percentage number in floating point if</span>
<span class="sd">            the input VRef is set successfully</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">percent_vref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eye_scan_vref_percentage</span><span class="p">(</span><span class="n">vref</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">percent_vref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vref</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vref</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;es_vref_min&quot;</span><span class="p">:</span> <span class="n">vref</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">percent_vref</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_vref_max"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.set_eye_scan_vref_max">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_vref_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan desired maximum vref value to scan</span>

<span class="sd">        Args:</span>

<span class="sd">            vref:</span>
<span class="sd">                For Read mode, valid integer range between 0 to 1023</span>
<span class="sd">                For Write mode, valid integer range between 0 to 50</span>

<span class="sd">        Returns:</span>

<span class="sd">            A translated percentage number in floating point if</span>
<span class="sd">            the input VRef is set successfully</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">percent_vref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eye_scan_vref_percentage</span><span class="p">(</span><span class="n">vref</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">percent_vref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vref</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vref</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;es_vref_max&quot;</span><span class="p">:</span> <span class="n">vref</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">percent_vref</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_vref_steps"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.set_eye_scan_vref_steps">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_vref_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan desired number of vref steps to scan vertically</span>

<span class="sd">        Args:</span>

<span class="sd">            steps:</span>
<span class="sd">                Valid integer range between 1 to 1024 for Read mode.</span>
<span class="sd">                Valid integer range between 1 to 51 for Write mode.</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">([</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">])</span>
        <span class="n">rw_mode</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: Please re-enter an integer value for Vref steps.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">rw_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span> <span class="ow">and</span> <span class="p">(</span><span class="n">steps</span> <span class="o">&gt;</span> <span class="mi">51</span><span class="p">):</span>
                <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot enter Vref step sizes larger than 51 for Write Margin mode&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span> <span class="ow">and</span> <span class="p">(</span><span class="n">steps</span> <span class="o">&gt;</span> <span class="mi">129</span><span class="p">):</span>
                <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot enter Vref step sizes larger than 129 for Write Margin mode&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">elif</span> <span class="n">steps</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot enter Vref step sizes larger than 1024 for Read Margin mode&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;es_vref_steps&quot;</span><span class="p">:</span> <span class="n">steps</span><span class="p">})</span>

        <span class="k">return</span></div>

    <span class="k">def</span> <span class="nf">__update_eye_scan_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
        <span class="n">clocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nqtr&quot;</span><span class="p">,</span> <span class="s2">&quot;pqtr&quot;</span><span class="p">]</span>
        <span class="n">clock_defs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;nqtr&quot;</span><span class="p">:</span> <span class="s2">&quot;fall_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pqtr&quot;</span><span class="p">:</span> <span class="s2">&quot;rise_&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">engine_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_eye_scan_data</span><span class="p">()</span>
        <span class="n">ps_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_margin_ps_factors</span><span class="p">()</span>
        <span class="n">data_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">engine_data</span><span class="p">)</span>

        <span class="c1"># If initial vref scan went wrong after enabled, needless to process data further</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">scan_mode</span> <span class="o">=</span> <span class="n">engine_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.mode&quot;</span><span class="p">]</span>
        <span class="n">nibble_count</span> <span class="o">=</span> <span class="n">engine_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.nibbles&quot;</span><span class="p">]</span>
        <span class="n">byte_count</span> <span class="o">=</span> <span class="n">engine_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.bytes&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;Read&quot;</span> <span class="ow">in</span> <span class="n">scan_mode</span><span class="p">:</span>
            <span class="n">old_key_base</span> <span class="o">=</span> <span class="s2">&quot;rdmargin_&quot;</span>
            <span class="n">new_key_base</span> <span class="o">=</span> <span class="s2">&quot;read_&quot;</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">engine_data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">nibble</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nibble_count</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">clock</span> <span class="ow">in</span> <span class="n">clocks</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                            <span class="n">old_key</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">old_key_base</span>
                                <span class="o">+</span> <span class="n">clock</span>
                                <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
                                <span class="o">+</span> <span class="n">edge</span>
                                <span class="o">+</span> <span class="s2">&quot;_nibble&quot;</span>
                                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nibble</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="n">ps_name</span> <span class="o">=</span> <span class="n">new_key_base</span> <span class="o">+</span> <span class="n">clock_defs</span><span class="p">[</span><span class="n">clock</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nibble</span><span class="p">)</span>
                            <span class="n">new_key</span> <span class="o">=</span> <span class="n">ps_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">edge</span>
                            <span class="n">new_key_ps</span> <span class="o">=</span> <span class="n">new_key</span> <span class="o">+</span> <span class="s2">&quot;_ps&quot;</span>
                            <span class="n">ps_factor</span> <span class="o">=</span> <span class="n">ps_factors</span><span class="p">[</span><span class="n">ps_name</span><span class="p">]</span>
                            <span class="n">tap_value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">old_key</span><span class="p">]</span>
                            <span class="n">ps_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tap_value</span> <span class="o">*</span> <span class="n">ps_factor</span><span class="p">))</span>
                            <span class="n">data</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tap_value</span>
                            <span class="n">data</span><span class="p">[</span><span class="n">new_key_ps</span><span class="p">]</span> <span class="o">=</span> <span class="n">ps_value</span>
                            <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="n">old_key</span><span class="p">]</span>
                <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;wrmargin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">}</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">temp_data</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
                <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">old_key_base</span> <span class="o">=</span> <span class="s2">&quot;wrmargin_&quot;</span>
            <span class="n">new_key_base</span> <span class="o">=</span> <span class="s2">&quot;write_&quot;</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">engine_data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">byte_count</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                        <span class="n">old_key</span> <span class="o">=</span> <span class="n">old_key_base</span> <span class="o">+</span> <span class="n">edge</span> <span class="o">+</span> <span class="s2">&quot;_byte&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
                        <span class="n">ps_name</span> <span class="o">=</span> <span class="n">new_key_base</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
                        <span class="n">new_key</span> <span class="o">=</span> <span class="n">ps_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">edge</span>
                        <span class="n">new_key_ps</span> <span class="o">=</span> <span class="n">new_key</span> <span class="o">+</span> <span class="s2">&quot;_ps&quot;</span>
                        <span class="n">ps_factor</span> <span class="o">=</span> <span class="n">ps_factors</span><span class="p">[</span><span class="n">ps_name</span><span class="p">]</span>
                        <span class="n">tap_value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">old_key</span><span class="p">]</span>
                        <span class="n">ps_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tap_value</span> <span class="o">*</span> <span class="n">ps_factor</span><span class="p">))</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tap_value</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">new_key_ps</span><span class="p">]</span> <span class="o">=</span> <span class="n">ps_value</span>
                        <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="n">old_key</span><span class="p">]</span>
                <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;rdmargin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">}</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">temp_data</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
                <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span> <span class="o">=</span> <span class="n">data_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;es_data_need_update&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">__update_gen5_eye_scan_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
        <span class="n">clocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nqtr&quot;</span><span class="p">,</span> <span class="s2">&quot;pqtr&quot;</span><span class="p">]</span>
        <span class="n">clock_defs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;nqtr&quot;</span><span class="p">:</span> <span class="s2">&quot;fall_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pqtr&quot;</span><span class="p">:</span> <span class="s2">&quot;rise_&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">engine_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_eye_scan_data</span><span class="p">()</span>
        <span class="n">data_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">engine_data</span><span class="p">)</span>

        <span class="c1"># If initial vref scan went wrong after enabled, needless to process data further</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">scan_mode</span> <span class="o">=</span> <span class="n">engine_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.mode&quot;</span><span class="p">]</span>
        <span class="n">bit_count</span> <span class="o">=</span> <span class="n">engine_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.bits&quot;</span><span class="p">]</span>
        <span class="n">byte_count</span> <span class="o">=</span> <span class="n">engine_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.bytes&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;Read&quot;</span> <span class="ow">in</span> <span class="n">scan_mode</span><span class="p">:</span>
            <span class="n">old_key_base</span> <span class="o">=</span> <span class="s2">&quot;rdmargin_&quot;</span>
            <span class="n">new_key_base</span> <span class="o">=</span> <span class="s2">&quot;read_&quot;</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">engine_data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bit_count</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">clock</span> <span class="ow">in</span> <span class="n">clocks</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                            <span class="n">old_key</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">old_key_base</span> <span class="o">+</span> <span class="n">clock</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">edge</span> <span class="o">+</span> <span class="s2">&quot;_bit&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bit</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="n">reformat_name</span> <span class="o">=</span> <span class="n">new_key_base</span> <span class="o">+</span> <span class="n">clock_defs</span><span class="p">[</span><span class="n">clock</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bit</span><span class="p">)</span>
                            <span class="n">new_key</span> <span class="o">=</span> <span class="n">reformat_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">edge</span>
                            <span class="n">tap_value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">old_key</span><span class="p">]</span>
                            <span class="n">data</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tap_value</span>
                            <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="n">old_key</span><span class="p">]</span>
                <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;wrmargin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">}</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">temp_data</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
                <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">engine_data</span><span class="p">:</span>
                <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;rdmargin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">}</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">temp_data</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
                <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span> <span class="o">=</span> <span class="n">data_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;es_data_need_update&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">__draw_eye_scan_graph</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">margin_data</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
        <span class="n">base_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">margin_title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">def_vrefs</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
        <span class="n">cur_max</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
        <span class="n">unit_string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">margin_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">vrefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">left_margs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">right_margs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_margs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">left_ps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">right_ps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">def_window_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">min_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">max_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">def_margin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">vref_swing</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y_min</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">margin_data</span><span class="p">:</span>
                <span class="n">cur_vref</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;config.vrefp&quot;</span><span class="p">])</span>
                <span class="n">vrefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_vref</span><span class="p">)</span>
                <span class="n">key_name</span> <span class="o">=</span> <span class="n">base_name</span> <span class="o">+</span> <span class="s2">&quot;_left&quot;</span>
                <span class="n">left_marg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">])</span>
                <span class="n">left_margs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_marg</span><span class="p">)</span>
                <span class="n">key_name</span> <span class="o">+=</span> <span class="s2">&quot;_ps&quot;</span>
                <span class="n">left_ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">]))</span>
                <span class="n">key_name</span> <span class="o">=</span> <span class="n">base_name</span> <span class="o">+</span> <span class="s2">&quot;_right&quot;</span>
                <span class="n">right_marg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">])</span>
                <span class="n">right_margs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_marg</span><span class="p">)</span>
                <span class="n">key_name</span> <span class="o">+=</span> <span class="s2">&quot;_ps&quot;</span>
                <span class="n">right_ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">]))</span>
                <span class="n">total_margin</span> <span class="o">=</span> <span class="n">left_marg</span> <span class="o">+</span> <span class="n">right_marg</span>
                <span class="n">total_margs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_margin</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">def_window_found</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cur_vref</span> <span class="o">==</span> <span class="n">def_vrefs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">def_margin</span> <span class="o">=</span> <span class="n">total_margin</span>
                        <span class="n">def_window_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">cur_vref</span> <span class="o">&lt;</span> <span class="n">def_vrefs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">total_margin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">min_found</span><span class="p">:</span>
                            <span class="n">min_found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">min_found</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">total_margin</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">y_min</span> <span class="o">=</span> <span class="n">cur_vref</span>
                        <span class="n">y_max</span> <span class="o">=</span> <span class="n">cur_vref</span>
                        <span class="n">min_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">max_found</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">total_margin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">max_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">y_max</span> <span class="o">=</span> <span class="n">cur_vref</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ps_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_margin_ps_factors</span><span class="p">()</span>
            <span class="n">ps_factor</span> <span class="o">=</span> <span class="n">ps_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="s2">&quot;wrmargin&quot;</span> <span class="ow">in</span> <span class="n">base_name</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">margin_data</span><span class="p">:</span>
                    <span class="n">cur_vref</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;config.vrefp&quot;</span><span class="p">])</span>
                    <span class="n">vrefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_vref</span><span class="p">)</span>
                    <span class="n">key_name</span> <span class="o">=</span> <span class="n">base_name</span> <span class="o">+</span> <span class="s2">&quot;left_lsb_&quot;</span> <span class="o">+</span> <span class="n">unit_string</span>
                    <span class="n">tap_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">])</span>
                    <span class="n">key_name</span> <span class="o">=</span> <span class="n">base_name</span> <span class="o">+</span> <span class="s2">&quot;left_msb_&quot;</span> <span class="o">+</span> <span class="n">unit_string</span>
                    <span class="n">msb_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">])</span>
                    <span class="n">left_marg</span> <span class="o">=</span> <span class="p">(</span><span class="n">msb_val</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">))</span> <span class="o">+</span> <span class="n">tap_val</span>
                    <span class="n">left_margs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_marg</span><span class="p">)</span>
                    <span class="n">ps_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">left_marg</span> <span class="o">*</span> <span class="n">ps_factor</span><span class="p">))</span>
                    <span class="n">left_ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ps_val</span><span class="p">)</span>
                    <span class="n">key_name</span> <span class="o">=</span> <span class="n">base_name</span> <span class="o">+</span> <span class="s2">&quot;right_lsb_&quot;</span> <span class="o">+</span> <span class="n">unit_string</span>
                    <span class="n">tap_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">])</span>
                    <span class="n">key_name</span> <span class="o">=</span> <span class="n">base_name</span> <span class="o">+</span> <span class="s2">&quot;right_msb_&quot;</span> <span class="o">+</span> <span class="n">unit_string</span>
                    <span class="n">msb_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">])</span>
                    <span class="n">right_marg</span> <span class="o">=</span> <span class="p">(</span><span class="n">msb_val</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">))</span> <span class="o">+</span> <span class="n">tap_val</span>
                    <span class="n">right_margs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_marg</span><span class="p">)</span>
                    <span class="n">ps_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">right_marg</span> <span class="o">*</span> <span class="n">ps_factor</span><span class="p">))</span>
                    <span class="n">right_ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ps_val</span><span class="p">)</span>
                    <span class="n">total_margin</span> <span class="o">=</span> <span class="n">left_marg</span> <span class="o">+</span> <span class="n">right_marg</span>
                    <span class="n">total_margs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_margin</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">def_window_found</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cur_vref</span> <span class="o">==</span> <span class="n">def_vrefs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">def_margin</span> <span class="o">=</span> <span class="n">total_margin</span>
                            <span class="n">def_window_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">cur_vref</span> <span class="o">&lt;</span> <span class="n">def_vrefs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">total_margin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">min_found</span><span class="p">:</span>
                                <span class="n">min_found</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">min_found</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">total_margin</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">y_min</span> <span class="o">=</span> <span class="n">cur_vref</span>
                            <span class="n">y_max</span> <span class="o">=</span> <span class="n">cur_vref</span>
                            <span class="n">min_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">max_found</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">total_margin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">max_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">y_max</span> <span class="o">=</span> <span class="n">cur_vref</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">margin_data</span><span class="p">:</span>
                    <span class="n">cur_vref</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;config.vrefp&quot;</span><span class="p">])</span>
                    <span class="n">vrefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_vref</span><span class="p">)</span>
                    <span class="n">key_name</span> <span class="o">=</span> <span class="n">base_name</span> <span class="o">+</span> <span class="s2">&quot;_left&quot;</span>
                    <span class="n">left_marg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">])</span>
                    <span class="n">left_margs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_marg</span><span class="p">)</span>
                    <span class="n">ps_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">left_marg</span> <span class="o">*</span> <span class="n">ps_factor</span><span class="p">))</span>
                    <span class="n">left_ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ps_val</span><span class="p">)</span>
                    <span class="n">key_name</span> <span class="o">=</span> <span class="n">base_name</span> <span class="o">+</span> <span class="s2">&quot;_right&quot;</span>
                    <span class="n">right_marg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">])</span>
                    <span class="n">right_margs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_marg</span><span class="p">)</span>
                    <span class="n">ps_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">right_marg</span> <span class="o">*</span> <span class="n">ps_factor</span><span class="p">))</span>
                    <span class="n">right_ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ps_val</span><span class="p">)</span>
                    <span class="n">total_margin</span> <span class="o">=</span> <span class="n">left_marg</span> <span class="o">+</span> <span class="n">right_marg</span>
                    <span class="n">total_margs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_margin</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">def_window_found</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cur_vref</span> <span class="o">==</span> <span class="n">def_vrefs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">def_margin</span> <span class="o">=</span> <span class="n">total_margin</span>
                            <span class="n">def_window_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">cur_vref</span> <span class="o">&lt;</span> <span class="n">def_vrefs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">total_margin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">min_found</span><span class="p">:</span>
                                <span class="n">min_found</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">min_found</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">total_margin</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">y_min</span> <span class="o">=</span> <span class="n">cur_vref</span>
                            <span class="n">y_max</span> <span class="o">=</span> <span class="n">cur_vref</span>
                            <span class="n">min_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">max_found</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">total_margin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">max_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">y_max</span> <span class="o">=</span> <span class="n">cur_vref</span>

        <span class="n">x_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">left_ps</span><span class="p">)</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">right_ps</span><span class="p">)</span>
        <span class="n">max_marg</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">total_margs</span><span class="p">)</span>
        <span class="n">max_marg_idx</span> <span class="o">=</span> <span class="n">total_margs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">max_marg</span><span class="p">)</span>
        <span class="n">max_marg_vref</span> <span class="o">=</span> <span class="n">vrefs</span><span class="p">[</span><span class="n">max_marg_idx</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">def_window_found</span><span class="p">:</span>
            <span class="n">def_window</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">init_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">scan_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span>
            <span class="n">init_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__draw_eye_scan_graph</span><span class="p">(</span>
                <span class="n">init_list</span><span class="p">,</span> <span class="n">base_name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">def_vrefs</span><span class="p">,</span> <span class="n">def_window</span><span class="p">,</span> <span class="n">unit_string</span><span class="p">,</span> <span class="n">margin_only</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">def_margin</span> <span class="o">=</span> <span class="n">def_window</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vref_swing</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">cur_max</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">max_marg</span><span class="p">,</span> <span class="n">max_marg_vref</span><span class="p">,</span> <span class="n">def_margin</span><span class="p">,</span> <span class="n">def_vrefs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vref_swing</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">margin_only</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">data_defs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;VRef&quot;</span><span class="p">:</span> <span class="n">vrefs</span><span class="p">,</span>
            <span class="s2">&quot;Left_Margin&quot;</span><span class="p">:</span> <span class="n">left_margs</span><span class="p">,</span>
            <span class="s2">&quot;Right_Margin&quot;</span><span class="p">:</span> <span class="n">right_margs</span><span class="p">,</span>
            <span class="s2">&quot;Left_PS&quot;</span><span class="p">:</span> <span class="n">left_ps</span><span class="p">,</span>
            <span class="s2">&quot;Right_PS&quot;</span><span class="p">:</span> <span class="n">right_ps</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_defs</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">df_left</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="n">ps_left</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
            <span class="n">data_left</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_left</span><span class="p">,</span> <span class="n">ps_left</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=-</span><span class="n">ps_left</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                    <span class="n">customdata</span><span class="o">=</span><span class="n">data_left</span><span class="p">,</span>
                    <span class="n">marker_color</span><span class="o">=</span><span class="s2">&quot;#75ad0a&quot;</span><span class="p">,</span>
                    <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;Taps: %</span><span class="si">{customdata[0]}</span><span class="s2"> &lt;br&gt;pS: %</span><span class="si">{customdata[1]}</span><span class="s2"> &lt;br&gt;VRef: %</span><span class="si">{y}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]:</span>
            <span class="n">df_right</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="n">ps_right</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
            <span class="n">data_right</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_right</span><span class="p">,</span> <span class="n">ps_right</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">ps_right</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                    <span class="n">customdata</span><span class="o">=</span><span class="n">data_right</span><span class="p">,</span>
                    <span class="n">marker_color</span><span class="o">=</span><span class="s2">&quot;#0073e6&quot;</span><span class="p">,</span>
                    <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;Taps: %</span><span class="si">{customdata[0]}</span><span class="s2"> &lt;br&gt;pS: %</span><span class="si">{customdata[1]}</span><span class="s2"> &lt;br&gt;VRef: %</span><span class="si">{y}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">def_vrefs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">display_vref</span> <span class="o">=</span> <span class="n">def_vrefs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">display_text</span> <span class="o">=</span> <span class="s2">&quot;Cal. VRef: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">display_vref</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">display_vref</span> <span class="o">=</span> <span class="n">def_vrefs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">display_text</span> <span class="o">=</span> <span class="s2">&quot;Def. VRef: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">display_vref</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">],</span>
                <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">display_vref</span><span class="p">,</span> <span class="n">display_vref</span><span class="p">],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#92b1a9&quot;</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="n">display_text</span><span class="p">,</span>
                <span class="n">customdata</span><span class="o">=</span><span class="p">[</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">],</span>
                <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;%</span><span class="si">{customdata}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">barmode</span><span class="o">=</span><span class="s2">&quot;relative&quot;</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
            <span class="n">bargap</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s2">&quot;#0f263e&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">margin_title</span><span class="p">,</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Delay in pS&quot;</span><span class="p">),</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;VRef Percentage&quot;</span><span class="p">),</span>
            <span class="n">legend_orientation</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>
            <span class="n">legend_x</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">legend_y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>

<div class="viewcode-block" id="DDR.save_eye_scan_data"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.save_eye_scan_data">[docs]</a>    <span class="k">def</span> <span class="nf">save_eye_scan_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the eye scan 2D margin data from the most recent run to a file in CSV format</span>

<span class="sd">        Args:</span>

<span class="sd">            file_name: the file name or full path for the data file to be saved.</span>
<span class="sd">                       A default file name will be given if none is supplied.</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out_file</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_name</span><span class="p">:</span>
            <span class="c1"># Gives a default for users</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;eye_scan_data&quot;</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_gen5_eye_scan_data</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_eye_scan_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: No scan data is found. Please re-run 2D eye scan.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">data_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span>
        <span class="n">all_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_file</span><span class="p">:</span>
            <span class="n">data_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="n">all_keys</span><span class="p">)</span>
            <span class="n">data_writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="n">data_writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Info: Data are being formatted and saved to:&quot;</span><span class="p">,</span> <span class="n">out_file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="DDR.load_eye_scan_data"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.load_eye_scan_data">[docs]</a>    <span class="k">def</span> <span class="nf">load_eye_scan_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the eye scan 2D margin data from a data file</span>

<span class="sd">        Args:</span>

<span class="sd">            file_name: the file name or full path for the data file to be read and load</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="n">file_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
            <span class="n">data_reader</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_reader</span><span class="p">:</span>
                <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">data_file</span><span class="o">.</span><span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span> <span class="o">=</span> <span class="n">data_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;es_data_need_update&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Info: Scan data are being loaded successfully from:&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="DDR.run_eye_scan"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.run_eye_scan">[docs]</a>    <span class="k">def</span> <span class="nf">run_eye_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">done</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">DoneFutureCallback</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">CsFuture</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kick off a run on 2D margin analysis and prepare scan data which is needed to draw an</span>
<span class="sd">        eye scan graph. The default scan settings will be used if users have not configured with</span>
<span class="sd">        new settings. See the following related commands for more info:</span>

<span class="sd">            save_eye_scan_data()</span>
<span class="sd">            load_eye_scan_data()</span>
<span class="sd">            display_eye_scan()</span>
<span class="sd">            check_eye_scan_window()</span>
<span class="sd">            check_eye_scan_height()</span>

<span class="sd">        Args:</span>
<span class="sd">            done: Optional command callback that will be invoked when the scan is finished</span>

<span class="sd">        Returns:</span>
<span class="sd">            Boolean value indicating success of the 2D margin scan</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Perform some logical data check on user settings</span>
        <span class="n">prop_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">)</span>
        <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;es_vref_min&quot;</span><span class="p">)</span>
        <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;es_vref_max&quot;</span><span class="p">)</span>
        <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;es_vref_steps&quot;</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="n">prop_list</span><span class="p">)</span>
        <span class="n">rw_mode</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">]</span>
        <span class="n">vref_min</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;es_vref_min&quot;</span><span class="p">]</span>
        <span class="n">vref_max</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;es_vref_max&quot;</span><span class="p">]</span>
        <span class="n">vref_steps</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;es_vref_steps&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rw_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span><span class="p">:</span>
                <span class="n">vref_threshold</span> <span class="o">=</span> <span class="mi">128</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vref_threshold</span> <span class="o">=</span> <span class="mi">50</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">vref_min</span> <span class="o">&gt;</span> <span class="n">vref_threshold</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">vref_max</span> <span class="o">&gt;</span> <span class="n">vref_threshold</span><span class="p">):</span>
                <span class="n">printer</span><span class="p">(</span>
                    <span class="s2">&quot;ERROR: Cannot set Vref values larger than &quot;</span><span class="p">,</span>
                    <span class="n">vref_threshold</span><span class="p">,</span>
                    <span class="s2">&quot; under Write margin mode.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">vref_steps</span> <span class="o">&gt;</span> <span class="n">vref_threshold</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">printer</span><span class="p">(</span>
                    <span class="s2">&quot;ERROR: Cannot set Vref step sizes larger than &quot;</span><span class="p">,</span>
                    <span class="n">vref_threshold</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot; for Write Margin mode&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">vref_min</span> <span class="o">&gt;</span> <span class="n">vref_max</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot set minimum Vref value larger than maximum Vref value.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">percent_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eye_scan_vref_percentage</span><span class="p">(</span><span class="n">vref_min</span><span class="p">)</span>
        <span class="n">percent_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eye_scan_vref_percentage</span><span class="p">(</span><span class="n">vref_max</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;Min VRef is set at:&quot;</span><span class="p">,</span> <span class="n">percent_min</span><span class="p">,</span> <span class="s2">&quot;%, encoded value&quot;</span><span class="p">,</span> <span class="n">vref_min</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;Max VRef is set at:&quot;</span><span class="p">,</span> <span class="n">percent_max</span><span class="p">,</span> <span class="s2">&quot;%, encoded value&quot;</span><span class="p">,</span> <span class="n">vref_max</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;Number of VRef steps is set at:&quot;</span><span class="p">,</span> <span class="n">vref_steps</span><span class="p">)</span>

        <span class="n">vref_incr_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">vref_max</span> <span class="o">-</span> <span class="n">vref_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">vref_steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">max_step_size</span> <span class="o">=</span> <span class="n">vref_max</span> <span class="o">-</span> <span class="n">vref_min</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">vref_incr_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span>
                <span class="s2">&quot;ERROR: For the selected VRef Min and VRef Max, the maximum step size is: &quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">max_step_size</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">printer</span><span class="p">(</span>
                <span class="s2">&quot;Please either reduce the VRef steps or increase the VRef range by adjusting Min/Max.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">scan_future</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">CsFutureSync</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>

        <span class="c1"># Institute a Progress Bar</span>
        <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">PercentProgressBar</span><span class="p">()</span>
        <span class="n">in_progress</span> <span class="o">=</span> <span class="s2">&quot;[bold dodger_blue2]In Progress[/]&quot;</span>
        <span class="n">progress_bar</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;2D Margin Scan Progress&quot;</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">PercentProgressBar</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">STARTING</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">progress_update</span><span class="p">(</span><span class="n">future</span><span class="p">):</span>
            <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">completed</span><span class="o">=</span><span class="n">future</span><span class="o">.</span><span class="n">progress</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">in_progress</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">done_scan</span><span class="p">(</span><span class="n">future</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">future</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">PercentProgressBar</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">ABORTED</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">completed</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">PercentProgressBar</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">DONE</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">future</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                <span class="n">scan_future</span><span class="o">.</span><span class="n">set_exception</span><span class="p">(</span><span class="n">future</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scan_future</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="n">future</span><span class="p">):</span>
            <span class="c1"># Call on main thread for any final processing desired</span>
            <span class="n">result_list</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">_result</span>
            <span class="k">if</span> <span class="n">result_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="c1"># Can think about if want to provide auto-draw or</span>
                <span class="c1"># auto-save log for the users</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;COMPLETED&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>

            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;2D margin scan run status is: &quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">future</span><span class="p">(</span>
            <span class="n">progress</span><span class="o">=</span><span class="n">progress_update</span><span class="p">,</span> <span class="n">done</span><span class="o">=</span><span class="n">done_scan</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="n">finalize</span>
        <span class="p">)</span><span class="o">.</span><span class="n">run_eye_scan_async</span><span class="p">(</span><span class="n">data_checked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;Info: Margin Scans in progress...&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">scan_future</span> <span class="k">if</span> <span class="n">done</span> <span class="k">else</span> <span class="n">scan_future</span><span class="o">.</span><span class="n">result</span></div>

<div class="viewcode-block" id="DDR.display_eye_scan"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.display_eye_scan">[docs]</a>    <span class="k">def</span> <span class="nf">display_eye_scan</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">unit_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">return_as_list</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">display_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
        <span class="n">get_margin_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assemble and display 2D eye scan drawing in chart format. By default, it tries to process and</span>
<span class="sd">        draw from the scan data found in the most recent 2D eye scan run. Users have the option to</span>
<span class="sd">        load scan data first prior to using this function in order to display specific set of scan</span>
<span class="sd">        data, see load_eye_scan_data().</span>

<span class="sd">        By default, if no unit_index is specified, unit zero from the scan data will be displayed.</span>
<span class="sd">        For read margins, both rising and falling edge clock scan data will be processed and displayed.</span>

<span class="sd">        Args:</span>
<span class="sd">            unit_index: Specify the index from a set of scan data users intend to display, based on</span>
<span class="sd">                unit mode found in the scan settings (bit, nibble, byte)</span>

<span class="sd">            return_as_list: Optional argument, default to False. If set to True, the function will</span>
<span class="sd">                not display graphs by default. Instead, it returns a list of the grapghing objects</span>
<span class="sd">                back to the caller.</span>

<span class="sd">            display_type: Optional argument, default to dynamic. If set to static, a static image</span>
<span class="sd">                will be returned. If set to dynamic, a dynamic, interactive javascript view will be</span>
<span class="sd">                returned.</span>

<span class="sd">            get_margin_only: Optional argument, default to False. If set to True, this API call</span>
<span class="sd">                will process scan data only, per the specified unit_index, find its widest margin</span>
<span class="sd">                windows and return the values and along with their VRef points as a list of tuples.</span>
<span class="sd">                No graphing results will be given.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Figure objects from Plotly, if return_as_list is specified as True,</span>
<span class="sd">            None is return otherwise by default, but graphs will be displayed in a browser.</span>

<span class="sd">            If optional argument get_margin_only is set to True. A list, which contains tuples as</span>
<span class="sd">            (int, float) representing the widest window margin found and along with their VRef points</span>
<span class="sd">            after a scan is returned.</span>

<span class="sd">            For Read Margin, two data results are displayed or returned. (First data for Rising</span>
<span class="sd">            Clock edge, and the second for Falling Clock edge) For Write Margin, only one data</span>
<span class="sd">            result will be displayed or returned.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">get_margin_only</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">_plotting_pkgs_available</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Plotting packages not installed! Please run &quot;</span><span class="p">,</span>
                <span class="s2">&quot;&#39;pip install chipscopy[plotly,pandas]&#39;&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">([</span><span class="s2">&quot;es_data_need_update&quot;</span><span class="p">])</span>
        <span class="n">data_need_update</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;es_data_need_update&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">data_need_update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__update_gen5_eye_scan_data</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__update_eye_scan_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span>
                <span class="s2">&quot;ERROR: No scan data is found. Please re-run 2D eye scan, &quot;</span>
                <span class="s2">&quot;or load scan data first from a data log file.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit_index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: Please re-enter an integer value for unit_index.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">df_vrefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">figure_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span>
        <span class="n">mc_id</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.mc_id&quot;</span><span class="p">]</span>
        <span class="n">scan_mode</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.mode&quot;</span><span class="p">]</span>
        <span class="n">unit_mode</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.unit&quot;</span><span class="p">]</span>
        <span class="n">rank_num</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.rank&quot;</span><span class="p">]</span>
        <span class="n">mem_type</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.mem_type&quot;</span><span class="p">]</span>
        <span class="n">df_vref</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.df_vrefp&quot;</span><span class="p">]</span>
        <span class="n">df_vref</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df_vref</span><span class="p">)</span>
        <span class="n">df_vrefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_vref</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span><span class="p">:</span>
            <span class="n">nibble_count</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.nibbles&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bit_count</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.bits&quot;</span><span class="p">]</span>
        <span class="n">byte_count</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.bytes&quot;</span><span class="p">]</span>
        <span class="n">unit_val</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit_index</span><span class="p">)</span>
        <span class="n">unit_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">max_window</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of tuple (int, float)</span>
        <span class="n">window_results</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of tuple (int, float)</span>

        <span class="c1"># Some logical data check first on user inputs</span>
        <span class="k">if</span> <span class="n">unit_mode</span> <span class="o">==</span> <span class="s2">&quot;bit&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">unit_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">unit_index</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bit_count</span><span class="p">)):</span>
                <span class="n">max_unit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bit_count</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;ERROR: unit_index given for &quot;</span>
                    <span class="o">+</span> <span class="n">unit_mode</span>
                    <span class="o">+</span> <span class="s2">&quot; mode needs to be between 0 and &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_unit</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">err_msg</span> <span class="o">+=</span> <span class="s2">&quot;, based on current scan data found.&quot;</span>
                <span class="n">printer</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">unit_str</span> <span class="o">=</span> <span class="n">unit_mode</span> <span class="o">+</span> <span class="n">unit_val</span>
            <span class="k">if</span> <span class="s2">&quot;Read&quot;</span> <span class="ow">in</span> <span class="n">scan_mode</span><span class="p">:</span>
                <span class="n">key_name</span> <span class="o">=</span> <span class="s2">&quot;read_vref_val_&quot;</span> <span class="o">+</span> <span class="n">unit_str</span>
                <span class="n">cal_vref</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key_name</span> <span class="o">=</span> <span class="s2">&quot;write_vref_val_&quot;</span> <span class="o">+</span> <span class="n">unit_str</span>
                <span class="n">cal_vref</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cal_vref</span><span class="p">:</span>
                <span class="n">cal_vref</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cal_vref</span><span class="p">)</span>
                <span class="n">df_vrefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cal_vref</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">unit_mode</span> <span class="o">==</span> <span class="s2">&quot;nibble&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">unit_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">unit_index</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nibble_count</span><span class="p">)):</span>
                <span class="n">max_unit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nibble_count</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;ERROR: unit_index given for &quot;</span>
                    <span class="o">+</span> <span class="n">unit_mode</span>
                    <span class="o">+</span> <span class="s2">&quot; mode needs to be between 0 and &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_unit</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">err_msg</span> <span class="o">+=</span> <span class="s2">&quot;, based on current scan data found.&quot;</span>
                <span class="n">printer</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">elif</span> <span class="n">unit_mode</span> <span class="o">==</span> <span class="s2">&quot;byte&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">unit_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">unit_index</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">byte_count</span><span class="p">)):</span>
                <span class="n">max_unit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">byte_count</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;ERROR: unit_index given for &quot;</span>
                    <span class="o">+</span> <span class="n">unit_mode</span>
                    <span class="o">+</span> <span class="s2">&quot; mode needs to be between 0 and &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_unit</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">err_msg</span> <span class="o">+=</span> <span class="s2">&quot;, based on current scan data found.&quot;</span>
                <span class="n">printer</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">unit_str</span> <span class="o">=</span> <span class="n">unit_mode</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">unit_index</span><span class="p">)</span>

        <span class="n">mc_name</span> <span class="o">=</span> <span class="n">mc_id</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="s2">&quot;Read&quot;</span> <span class="ow">in</span> <span class="n">scan_mode</span><span class="p">:</span>
            <span class="n">clocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rise_&quot;</span><span class="p">,</span> <span class="s2">&quot;fall_&quot;</span><span class="p">]</span>
            <span class="n">clock_defs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;rise_&quot;</span><span class="p">:</span> <span class="s2">&quot; - Rising Edge Clock - &quot;</span><span class="p">,</span>
                <span class="s2">&quot;fall_&quot;</span><span class="p">:</span> <span class="s2">&quot; - Falling Edge Clock - &quot;</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="k">for</span> <span class="n">clock</span> <span class="ow">in</span> <span class="n">clocks</span><span class="p">:</span>
                <span class="n">name_base</span> <span class="o">=</span> <span class="s2">&quot;read_&quot;</span> <span class="o">+</span> <span class="n">clock</span> <span class="o">+</span> <span class="n">unit_val</span>
                <span class="n">margin_mode</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">scan_mode</span>
                    <span class="o">+</span> <span class="n">clock_defs</span><span class="p">[</span><span class="n">clock</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">unit_mode</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">unit_index</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;&lt;br&gt;&quot;</span>
                <span class="p">)</span>
                <span class="n">margin_mode</span> <span class="o">+=</span> <span class="n">mc_name</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span>
                <span class="n">margin_mode</span> <span class="o">+=</span> <span class="n">mem_type</span> <span class="o">+</span> <span class="s2">&quot; - Rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank_num</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">get_margin_only</span><span class="p">:</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__draw_eye_scan_graph</span><span class="p">(</span>
                        <span class="n">data_list</span><span class="p">,</span> <span class="n">name_base</span><span class="p">,</span> <span class="n">margin_mode</span><span class="p">,</span> <span class="n">df_vrefs</span><span class="p">,</span> <span class="n">max_window</span>
                    <span class="p">)</span>
                    <span class="n">figure_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                    <span class="n">printer</span><span class="p">(</span>
                        <span class="s2">&quot;Margin window found:&quot;</span><span class="p">,</span>
                        <span class="n">clock_defs</span><span class="p">[</span><span class="n">clock</span><span class="p">],</span>
                        <span class="n">max_window</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s2">&quot;fine taps at VRef %:&quot;</span><span class="p">,</span>
                        <span class="n">max_window</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__draw_eye_scan_graph</span><span class="p">(</span>
                        <span class="n">data_list</span><span class="p">,</span> <span class="n">name_base</span><span class="p">,</span> <span class="n">margin_mode</span><span class="p">,</span> <span class="n">df_vrefs</span><span class="p">,</span> <span class="n">max_window</span><span class="p">,</span> <span class="n">margin_only</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                    <span class="n">window_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_window</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">max_window</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">margin_mode</span> <span class="o">=</span> <span class="n">scan_mode</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">unit_mode</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">unit_index</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;br&gt;&quot;</span>
            <span class="n">margin_mode</span> <span class="o">+=</span> <span class="n">mc_name</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span>
            <span class="n">margin_mode</span> <span class="o">+=</span> <span class="n">mem_type</span> <span class="o">+</span> <span class="s2">&quot; - Rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank_num</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span><span class="p">:</span>
                <span class="n">name_base</span> <span class="o">=</span> <span class="s2">&quot;write_&quot;</span> <span class="o">+</span> <span class="n">unit_val</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">get_margin_only</span><span class="p">:</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__draw_eye_scan_graph</span><span class="p">(</span>
                        <span class="n">data_list</span><span class="p">,</span> <span class="n">name_base</span><span class="p">,</span> <span class="n">margin_mode</span><span class="p">,</span> <span class="n">df_vrefs</span><span class="p">,</span> <span class="n">max_window</span>
                    <span class="p">)</span>
                    <span class="n">printer</span><span class="p">(</span>
                        <span class="s2">&quot;Margin window found:&quot;</span><span class="p">,</span>
                        <span class="n">max_window</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s2">&quot;fine taps at VRef %:&quot;</span><span class="p">,</span>
                        <span class="n">max_window</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">figure_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__draw_eye_scan_graph</span><span class="p">(</span>
                        <span class="n">data_list</span><span class="p">,</span> <span class="n">name_base</span><span class="p">,</span> <span class="n">margin_mode</span><span class="p">,</span> <span class="n">df_vrefs</span><span class="p">,</span> <span class="n">max_window</span><span class="p">,</span> <span class="n">margin_only</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                    <span class="n">window_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_window</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name_base</span> <span class="o">=</span> <span class="s2">&quot;wrmargin_&quot;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">get_margin_only</span><span class="p">:</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__draw_eye_scan_graph</span><span class="p">(</span>
                        <span class="n">data_list</span><span class="p">,</span> <span class="n">name_base</span><span class="p">,</span> <span class="n">margin_mode</span><span class="p">,</span> <span class="n">df_vrefs</span><span class="p">,</span> <span class="n">max_window</span><span class="p">,</span> <span class="n">unit_str</span>
                    <span class="p">)</span>
                    <span class="n">printer</span><span class="p">(</span>
                        <span class="s2">&quot;Margin window found:&quot;</span><span class="p">,</span>
                        <span class="n">max_window</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s2">&quot;fine taps at VRef %:&quot;</span><span class="p">,</span>
                        <span class="n">max_window</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">figure_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__draw_eye_scan_graph</span><span class="p">(</span>
                        <span class="n">data_list</span><span class="p">,</span>
                        <span class="n">name_base</span><span class="p">,</span>
                        <span class="n">margin_mode</span><span class="p">,</span>
                        <span class="n">df_vrefs</span><span class="p">,</span>
                        <span class="n">max_window</span><span class="p">,</span>
                        <span class="n">unit_str</span><span class="p">,</span>
                        <span class="n">margin_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">window_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_window</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">get_margin_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">window_results</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_as_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figure_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">display_type</span> <span class="o">==</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">:</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">display_type</span> <span class="o">==</span> <span class="s2">&quot;static&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">_jupyter_available</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Jupyter packages not installed! Please run &#39;pip install chipscopy[jupyter]&#39;&quot;</span>
                        <span class="p">)</span>
                    <span class="n">image_bytes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">to_image</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
                    <span class="n">ipython_image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">image_bytes</span><span class="p">)</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">ipython_image</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;display_type argument must be static or dynamic&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">figure_list</span></div>

<div class="viewcode-block" id="DDR.check_eye_scan_height"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.check_eye_scan_height">[docs]</a>    <span class="k">def</span> <span class="nf">check_eye_scan_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate and obtain the VRef swing/height found from a margin scan by a specified unit index.</span>
<span class="sd">        The height is defined by having the lowest point of VRef that a non-zero margin window starts, and ends</span>
<span class="sd">        with the highest VRef point found in the same fashion. By default, it tries to process from the scan</span>
<span class="sd">        data found in the most recent 2D eye scan run. Users have the option to load scan data first prior to</span>
<span class="sd">        using this function, in order to process specific set of scan data, see load_eye_scan_data().</span>

<span class="sd">        Args:</span>
<span class="sd">            unit_index: Specify the index from a set of scan data users intend to display, based on</span>
<span class="sd">                unit mode found in the scan settings (bit, nibble, byte)</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list, which contains lists of floating point values representing the VRef percentage values</span>
<span class="sd">            in the following item order: [VRef swing, minimum VRef, maximum VRef]</span>
<span class="sd">            For Read Margin, two sets of data list are being returned. (First item from the list is for Rising</span>
<span class="sd">            Clock edge, and the second is for Falling Clock edge) For Write Margin, only one set of data list</span>
<span class="sd">            will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vref_results</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of list [float, float, float]</span>

        <span class="n">window_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_eye_scan</span><span class="p">(</span><span class="n">unit_index</span><span class="p">,</span> <span class="n">get_margin_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">window_results</span><span class="p">:</span>
            <span class="n">vref_results</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">window</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">window</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">window</span><span class="p">[</span><span class="mi">6</span><span class="p">]])</span>

        <span class="k">return</span> <span class="n">vref_results</span></div>

<div class="viewcode-block" id="DDR.check_eye_scan_window"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.check_eye_scan_window">[docs]</a>    <span class="k">def</span> <span class="nf">check_eye_scan_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">default_vref</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate and obtain the widest 2D eye scan margin window by a specified unit index. This function</span>
<span class="sd">        also checks the margin window found at default VRef setting determined by the memory controller.</span>
<span class="sd">        By default, it tries to process from the scan data found in the most recent 2D eye scan run. Users</span>
<span class="sd">        have the option to load scan data first prior to using this function, in order to process specific</span>
<span class="sd">        set of scan data, see load_eye_scan_data().</span>

<span class="sd">        Args:</span>
<span class="sd">            unit_index: Specify the index from a set of scan data users intend to display, based on</span>
<span class="sd">                unit mode found in the scan settings (bit, nibble, byte)</span>

<span class="sd">            default_vref: Optional argument, default to False, which means the function will check and report</span>
<span class="sd">                the widest margin window found and along with its corrosponding vref value at the earliest point.</span>
<span class="sd">                If set to True, the function will report margin window found at its default VRef point instead.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list, which contains tuples of (int, float) will be returned. The first integer item from the</span>
<span class="sd">            tuples represents the window margin found after a scan, and the second item indicates the VRef</span>
<span class="sd">            setting value in floating point.</span>

<span class="sd">            For Read Margin, two data results are being returned. (First tuple of data is for Rising</span>
<span class="sd">            Clock edge, and the second is for Falling Clock edge) For Write Margin, only one tuple</span>
<span class="sd">            result will be returned.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">checked_results</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of tuples (int, float)</span>
        <span class="n">return_idx0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">return_idx1</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">window_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_eye_scan</span><span class="p">(</span><span class="n">unit_index</span><span class="p">,</span> <span class="n">get_margin_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">default_vref</span><span class="p">:</span>
            <span class="n">return_idx0</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="n">return_idx1</span> <span class="o">+=</span> <span class="mi">2</span>

        <span class="c1"># Read Modes</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">window_results</span><span class="p">:</span>
                <span class="n">checked_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">window</span><span class="p">[</span><span class="n">return_idx0</span><span class="p">],</span> <span class="n">window</span><span class="p">[</span><span class="n">return_idx1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Write Modes</span>
            <span class="n">window</span> <span class="o">=</span> <span class="n">window_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">checked_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">window</span><span class="p">[</span><span class="n">return_idx0</span><span class="p">],</span> <span class="n">window</span><span class="p">[</span><span class="n">return_idx1</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">checked_results</span></div>

<div class="viewcode-block" id="DDR.get_cal_vref"><a class="viewcode-back" href="../../../../ddr.html#chipscopy.api.ddr.ddr.DDR.get_cal_vref">[docs]</a>    <span class="k">def</span> <span class="nf">get_cal_vref</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">unit_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Only supported on Gen5 DDRs. This function finds and returns the calibrated VRef in percentage</span>
<span class="sd">        value per specified unit index. By default, it tries to process from the scan data found in the</span>
<span class="sd">        most recent 2D eye scan run. Users have the option to load scan data first prior to calling this</span>
<span class="sd">        function, in order to process specific set of scan data, see load_eye_scan_data().</span>

<span class="sd">        Args:</span>
<span class="sd">            unit_index: Specify the target index within a set of scan data, based on unit mode found in</span>
<span class="sd">            the scan settings (bit, nibble, byte)</span>

<span class="sd">        Returns:</span>
<span class="sd">            A floating point number that represents the calibrated VRef in percentage value.</span>
<span class="sd">            Note that this number will be defaulted to zero if the calibrated VRef cannot be found.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gen5</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: This function is currently supported on Gen5 DDRs only.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">([</span><span class="s2">&quot;es_data_need_update&quot;</span><span class="p">])</span>
        <span class="n">data_need_update</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;es_data_need_update&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">data_need_update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_gen5_eye_scan_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span>
                <span class="s2">&quot;ERROR: No scan data is found. Please re-run 2D eye scan, &quot;</span>
                <span class="s2">&quot;or load scan data first from a data log file.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit_index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;ERROR: Please re-enter an integer value for unit_index.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">data_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span>
        <span class="n">scan_mode</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.mode&quot;</span><span class="p">]</span>
        <span class="n">unit_mode</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.unit&quot;</span><span class="p">]</span>
        <span class="n">bit_count</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.bits&quot;</span><span class="p">]</span>
        <span class="n">unit_val</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit_index</span><span class="p">)</span>
        <span class="n">unit_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Logical data check first on user input</span>
        <span class="k">if</span> <span class="n">unit_mode</span> <span class="o">==</span> <span class="s2">&quot;bit&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">unit_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">unit_index</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bit_count</span><span class="p">)):</span>
                <span class="n">max_unit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bit_count</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;ERROR: unit_index given for &quot;</span>
                    <span class="o">+</span> <span class="n">unit_mode</span>
                    <span class="o">+</span> <span class="s2">&quot; mode needs to be between 0 and &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_unit</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">err_msg</span> <span class="o">+=</span> <span class="s2">&quot;, based on current scan data found.&quot;</span>
                <span class="n">printer</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">unit_str</span> <span class="o">=</span> <span class="n">unit_mode</span> <span class="o">+</span> <span class="n">unit_val</span>
            <span class="k">if</span> <span class="s2">&quot;Read&quot;</span> <span class="ow">in</span> <span class="n">scan_mode</span><span class="p">:</span>
                <span class="n">key_name</span> <span class="o">=</span> <span class="s2">&quot;read_vref_val_&quot;</span> <span class="o">+</span> <span class="n">unit_str</span>
                <span class="n">cal_vref</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key_name</span> <span class="o">=</span> <span class="s2">&quot;write_vref_val_&quot;</span> <span class="o">+</span> <span class="n">unit_str</span>
                <span class="n">cal_vref</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">printer</span><span class="p">(</span>
                <span class="s2">&quot;ERROR: Scan data shows that non-bit unit mode found, &quot;</span>
                <span class="s2">&quot;which is currently not supported.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">cal_vref</span><span class="p">:</span>
            <span class="n">cal_vref</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cal_vref</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cal_vref</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">cal_vref</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>
</pre></div>

           </div>
          </div>
          
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2024, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on June 06, 2024.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>