..
  Copyright 2021 Xilinx, Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

User Python Setup
=================

There are several ways to configure your system with Python. We recommend and document a no-frills
`Basic Python Installation`_.

If you're a seasoned python user you can skip ahead to the section, this will assume you've got python and you know how
to manage environments, packages, and pip configuration:
`Manual Installation`_.

Basic Python Installation
-------------------------

This section covers installing the Python base interpreter.

Python installers can be found here: `<https://www.python.org/downloads/>`_. ChipScoPy requires Python 3.8 or newer.

Windows 10 (v1909) users may opt to install python through the Microsoft Store. Simply search for python and select the
language version you want to install. At this time Python 3.8 offers the most stability and usability. Python 3.9 has
not been tested with ChipScoPy.

Download and install Python. When it asks if you want to update the ``PATH`` variable, it's highly recommended you
take that action. Once you have python installed, you may use the setup script in
`Automated Installer`_ to complete the rest of the installation.

.. warning:: **NEVER** invoke ``sudo`` to install python packages. Installing python packages with ``sudo`` can
             accidentally overwrite existing system files.


Virtual Environments 
--------------------

A virtual environment is an isolated Python environment. It allows ChipScoPy and its dependencies to be installed
without interfering with the behavior of any other Python applications. The use of virtual environments is best
practice.

.. note:: For more information about Python virtual environments, check out the official
          `Python Virtual Environment Documentation <https://docs.python.org/3.7/tutorial/venv.html>`_.


Automated Installer
-------------------

The installation script is provided to simplify the installation of ChipScoPy in a Python virtual environment.

Bring up a Windows Powershell. Make sure Python 3.8 is available in your path by checking the version as shown
below. If Python is not executable from the console, stop and check your installation. Make sure Python has been
installed from the Microsoft Store or python.org. Nothing works without a functional Python installation.


.. code-block:: PowerShell

    PS > python --version
    Python 3.8.3


Copy and paste the snippet below into the Powershell window. This will set up a virtual environment, install ChipScoPy,
and install examples in one step.

Windows:


.. code-block:: powershell

    Invoke-WebRequest -Uri "https://github.com/Xilinx/chipscopy/raw/master/docs/internal/get-chipscopy.py" -OutFile get-chipscopy.py; python get-chipscopy.py



Linux:

.. code-block:: shell

    curl -sSL https://github.com/Xilinx/chipscopy/raw/master/docs/internal/get-chipscopy.py -o get-chipscopy.py; python get-chipscopy.py



Follow the interactive script. It will ask where the virtual environment should be created. Example installer output:
And after the environment is created, pip will proceed with the installation of chipscopy.

.. note:: These scripts will install the latest version of the ChipScoPy package. To install alternate versions of the
          package see the alternate invocation in `Install ChipScoPy`_.

The final step in the installer is to unpack the examples. Pay attention to the script output as extraction will
fail if the examples are already unpacked in the target location--user's home directory.

The script terminates with instructions on how to activate the virtual environment. The user must activate the
virtualenv subsequently, and every time the shell is re-launched.

Installation is complete. The rest of this document outlines the manual installation process. It is not necessary to
perform these steps when the installer script is used.

The next step is to explore the examples.


-------------------


Manual Installation
-------------------

This section is for advanced python users. It describes the manual steps to setup the environment. If anything is
unfamiliar here, or there are issues, feel free to use the installer described in `Automated Installer`_. 

Install ChipScoPy
^^^^^^^^^^^^^^^^^

If you used one of the installer scripts above, this section was already done by the installer script. Skip ahead to the
section `Setup Dependencies`_.

It's time to install the ChipScoPy package itself. With your python environment active run:

.. code-block:: shell

    (chipscopy) > python -m pip install chipscopy
    [or]
    (chipscopy) > python -m pip install chipscopy==2020.2.*   # installs latest version of 2020.2


Setup Dependencies
^^^^^^^^^^^^^^^^^^

With the environment active you may need to install some additional packages that aren't listed in the ChipScoPy
project-level dependencies. If you intend to use any of these client examples, then
you'll need to get additional items.

.. code-block:: none

    pcie        -- networkx                        -- python -m pip install networkx
    noc-perfmon -- pyqt (5+) , matplotlib          -- python -m pip install PyQt5 matplotlib
    all         -- jupyter (for running notebooks) -- python -m pip install juypter

Use pip to install these as well, be sure your environment is active.

Congrats--if you're still awake and you've followed the steps till here, you are the proud owner of a functional Python
setup. Next steps are to start exploring the examples.


Install ChipScoPy Examples
^^^^^^^^^^^^^^^^^^^^^^^^^^^

Now that the ChipScoPy package has been installed, there is an alias to install the examples into a particular directory
chosen by the user.

.. code-block:: shell

    (chipscopy) > chipscopy-get-examples
    The following examples  will be delivered to `/home/dkopelov/chipscopy-examples`:
    - ddr_example.ipynb
    - ddr_example.py
    - basic_detect.py
    ...


Make note of the location to which these are extracted.


Starting Jupyter
^^^^^^^^^^^^^^^^^^^^^

Assuming you installed the ``jupyter`` package into your virtual environment, you can use the notebooks provided with
the examples.

Launch the server:

.. code-block:: shell

    (chipscopy) > jupyter notebook


This should launch the server in a browser window on your local machine. Simply navigate to the directory to which you
deployed the ChipScoPy examples and then you may run any notebook included with the release.


ChipScoPy Updates
^^^^^^^^^^^^^^^^^

As the development team pushes fixes and features; ``pip``, again, is the recommended tool for grabbing the latest
software.

.. code-block:: shell

    (chipscopy) > python -m pip install --upgrade chipscopy


To get the latest software for a specific release (2020.2 in this example):

.. code-block:: shell

    (chipscopy) > python -m pip install --upgrade chipscopy==2020.2.*


And don't forget to extract the latest examples after each package update:

.. code-block:: shell

    (chipscopy) > chipscopy-get-examples
