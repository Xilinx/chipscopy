


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../../../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> ChipScoPy
          

          
          </a>

          
            
            
              <div class="version">
                2021.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">ChipScoPy Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chipscopy_installation.html">ChipScoPy Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_setup.html">Developer Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">ChipScoPy Debug Core API Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ddr.html">DDR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ibert.html">IBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ila.html">ILA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../memory.html">Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../noc.html">NocPerfmon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pcie.html">PCIe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sysmon.html">SysMon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../vio.html">VIO</a></li>
</ul>
<p class="caption"><span class="caption-text">Misc Classes &amp; Utility Functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../containers.html">Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../device.html">Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../report.html">Report</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../session.html">Session</a></li>
</ul>

            
			
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ChipScoPy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../api.html">chipscopy.api</a> &raquo;</li>
        
      <li>chipscopy.api.ddr</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for chipscopy.api.ddr</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2021 Xilinx, Inc.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">rich.progress</span> <span class="kn">import</span> <span class="n">Progress</span><span class="p">,</span> <span class="n">TextColumn</span><span class="p">,</span> <span class="n">BarColumn</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

    <span class="n">_plotting_pkgs_available</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_plotting_pkgs_available</span> <span class="o">=</span> <span class="kc">False</span>

<span class="kn">from</span> <span class="nn">chipscopy.dm</span> <span class="kn">import</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">chipscopy.tcf.services</span> <span class="kn">import</span> <span class="n">DoneHWCommand</span>
<span class="kn">from</span> <span class="nn">chipscopy.api</span> <span class="kn">import</span> <span class="n">CoreType</span>
<span class="kn">from</span> <span class="nn">chipscopy.api._detail.debug_core</span> <span class="kn">import</span> <span class="n">DebugCore</span>
<span class="kn">from</span> <span class="nn">chipscopy.utils.printer</span> <span class="kn">import</span> <span class="n">PercentProgressBar</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">chipscopy.client.ddrmc_client</span> <span class="kn">import</span> <span class="n">DDRMCClient</span>


<div class="viewcode-block" id="DDR"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DDR</span><span class="p">(</span><span class="n">DebugCore</span><span class="p">[</span><span class="s2">&quot;DDRMCClient&quot;</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class contains the top level API functions to interact with the</span>
<span class="sd">    integrated DDR memory controller debug core(s) on Versal devices.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ddr_node</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DDR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">CoreType</span><span class="o">.</span><span class="n">DDR</span><span class="p">,</span> <span class="n">ddr_node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="n">ddr_node</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ddr_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_tcf_node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_user_enabled</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="DDR.get_cal_status"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.get_cal_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_cal_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the main calibration status of DDRMC</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>
<span class="sd">            status in string</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_cal_status</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="DDR.refresh_cal_status"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.refresh_cal_status">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_cal_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">done</span><span class="p">:</span> <span class="n">DoneHWCommand</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh the main calibration status of DDRMC</span>

<span class="sd">        Args:</span>
<span class="sd">            done: Optional command callback that will be invoked when the response is received</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">refresh_cal_status</span><span class="p">(</span><span class="n">done</span><span class="p">)</span></div>

<div class="viewcode-block" id="DDR.get_cal_stages"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.get_cal_stages">[docs]</a>    <span class="k">def</span> <span class="nf">get_cal_stages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the decoded calibration stages results happened from a</span>
<span class="sd">        calibration run</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary where</span>
<span class="sd">                Key = calibration stage name</span>
<span class="sd">                Val = stage calibration result</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property_group</span><span class="p">([</span><span class="s2">&quot;stages&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="DDR.refresh_cal_margin"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.refresh_cal_margin">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_cal_margin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">done</span><span class="p">:</span> <span class="n">DoneHWCommand</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh the calibration windows margin analysis of DDRMC</span>

<span class="sd">        Args:</span>
<span class="sd">            done: Optional command callback that will be invoked when the response is received</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">refresh_cal_margin</span><span class="p">(</span><span class="n">done</span><span class="p">)</span></div>

<div class="viewcode-block" id="DDR.refresh_health_status"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.refresh_health_status">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_health_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">done</span><span class="p">:</span> <span class="n">DoneHWCommand</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh the overall health status analysis of DDRMC</span>

<span class="sd">        Args:</span>
<span class="sd">            done: Optional command callback that will be invoked when the response is received</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">refresh_health_status</span><span class="p">(</span><span class="n">done</span><span class="p">)</span></div>

<div class="viewcode-block" id="DDR.get_cal_margin_mode"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.get_cal_margin_mode">[docs]</a>    <span class="k">def</span> <span class="nf">get_cal_margin_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the availability of windows margin mode generated from a</span>
<span class="sd">        calibration run</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary where</span>
<span class="sd">                Key = name of margin mode</span>
<span class="sd">                Val = True or False value indicating the availability</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_cal_margin_mode</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="DDR.is_user_enabled"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.is_user_enabled">[docs]</a>    <span class="k">def</span> <span class="nf">is_user_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find out whether the DDRMC core is user enabled or not after</span>
<span class="sd">        Versal device configuration</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>
<span class="sd">            Status value in Bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if not being powered by NoC clock, it is automatically disabled</span>
        <span class="n">clock_off</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">is_clock_gated</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">clock_off</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;pcsr_control_ub_init&quot;</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="DDR.get_property"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.get_property">[docs]</a>    <span class="k">def</span> <span class="nf">get_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">property_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">done</span><span class="p">:</span> <span class="n">DoneHWCommand</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the property value mapped to DDRMC core</span>

<span class="sd">        Args:</span>
<span class="sd">            property_names: single string or list of string of property names</span>
<span class="sd">                (if None specified, all properties available will be queried and returned)</span>

<span class="sd">            done: Optional command callback that will be invoked when the response is received</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary, where</span>
<span class="sd">                Key = property name</span>
<span class="sd">                Val = property value</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="n">property_names</span><span class="p">,</span> <span class="n">done</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

    <span class="k">def</span> <span class="nf">__get_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">is_lrdimm</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;DDRMC Core Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;mem_type&quot;</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mem_type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Memory Interface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DDR4&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Memory Interface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LPDDR4&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Memory Interface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;dimm_type&quot;</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;dimm_type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Device Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Component&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Device Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;UDIMM&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Device Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RDIMM&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Device Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LRDIMM&quot;</span>
            <span class="n">is_lrdimm</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Device Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;slots&quot;</span><span class="p">)</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;slots&quot;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;phy_ranks&quot;</span><span class="p">)</span>
        <span class="n">phy_ranks</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;phy_ranks&quot;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;mem_ranks&quot;</span><span class="p">)</span>
        <span class="n">mem_ranks</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mem_ranks&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">is_lrdimm</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Slots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">phy_ranks</span><span class="p">)</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Ranks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mem_ranks</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Slots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Ranks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">phy_ranks</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;bytes&quot;</span><span class="p">)</span>
        <span class="nb">bytes</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;bytes&quot;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;nibbles&quot;</span><span class="p">)</span>
        <span class="n">nibbles</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;nibbles&quot;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;bits_per_byte&quot;</span><span class="p">)</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;bits_per_byte&quot;</span><span class="p">]</span>
        <span class="n">data_width</span> <span class="o">=</span> <span class="nb">bytes</span> <span class="o">*</span> <span class="n">bits</span>
        <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Data Width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_width</span><span class="p">)</span>
        <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Bytes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
        <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Nibbles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nibbles</span><span class="p">)</span>
        <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Bits per Byte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>

        <span class="n">freq_zero</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>
        <span class="n">freq_one</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;f0_period&quot;</span><span class="p">)</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;f0_period&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">period</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">period</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="n">freq0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1000000</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">freq_zero</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq0</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; MHz&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;f1_period&quot;</span><span class="p">)</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;f1_period&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">period</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">period</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="n">freq1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1000000</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">freq_one</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; MHz&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;dual_freq_en&quot;</span><span class="p">)</span>
        <span class="n">dual_freq</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;dual_freq_en&quot;</span><span class="p">]</span>
        <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Memory Frequency 0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq_zero</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">dual_freq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Memory Frequency 1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq_one</span>

        <span class="k">return</span> <span class="n">configs</span>

    <span class="k">def</span> <span class="nf">__get_cal_margins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode_base</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">left_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">right_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">centers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
        <span class="n">group_name</span> <span class="o">=</span> <span class="n">mode_base</span> <span class="o">+</span> <span class="s2">&quot;_left&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property_group</span><span class="p">([</span><span class="n">group_name</span><span class="p">])</span>
        <span class="n">left_margs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">left_margs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="n">group_name</span> <span class="o">=</span> <span class="n">mode_base</span> <span class="o">+</span> <span class="s2">&quot;_right&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property_group</span><span class="p">([</span><span class="n">group_name</span><span class="p">])</span>
        <span class="n">right_margs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">right_margs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="n">group_name</span> <span class="o">=</span> <span class="n">mode_base</span> <span class="o">+</span> <span class="s2">&quot;_center&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property_group</span><span class="p">([</span><span class="n">group_name</span><span class="p">])</span>
        <span class="n">centers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">centers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__output_read_margins</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">by_8_mode</span><span class="p">,</span>
        <span class="nb">bytes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">nibbles</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">left_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">right_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">centers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">left_marg_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">left_margs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">center_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">centers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">right_marg_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">right_margs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">by_8_mode</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
                <span class="n">left_marg</span> <span class="o">=</span> <span class="n">left_marg_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">center_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">right_marg</span> <span class="o">=</span> <span class="n">right_marg_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Byte &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">byte</span><span class="p">),</span>
                    <span class="s2">&quot; Nibble 0  -&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;  Left Margin:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)  Center Point:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)  Right Margin:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">left_marg</span> <span class="o">=</span> <span class="n">left_marg_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">center_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">right_marg</span> <span class="o">=</span> <span class="n">right_marg_vals</span><span class="p">[</span><span class="n">byte</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Byte &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">byte</span><span class="p">),</span>
                    <span class="s2">&quot; Nibble 1  -&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;  Left Margin:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)  Center Point:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)  Right Margin:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">nibble</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nibbles</span><span class="p">):</span>
                <span class="n">left_marg</span> <span class="o">=</span> <span class="n">left_marg_vals</span><span class="p">[</span><span class="n">nibble</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">center_vals</span><span class="p">[</span><span class="n">nibble</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">right_marg</span> <span class="o">=</span> <span class="n">right_marg_vals</span><span class="p">[</span><span class="n">nibble</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Nibble &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">nibble</span><span class="p">),</span>
                    <span class="s2">&quot;  -&quot;</span> <span class="s2">&quot;  Left Margin:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)  Center Point:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)  Right Margin:  &quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s2">&quot;)&quot;</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__output_write_margins</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">left_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">right_margs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">centers</span><span class="p">:</span> <span class="n">Dict</span>
    <span class="p">):</span>
        <span class="n">left_marg_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">left_margs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">center_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">centers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">right_marg_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">right_margs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
            <span class="n">left_marg</span> <span class="o">=</span> <span class="n">left_marg_vals</span><span class="p">[</span><span class="n">byte</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">center_vals</span><span class="p">[</span><span class="n">byte</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">right_marg</span> <span class="o">=</span> <span class="n">right_marg_vals</span><span class="p">[</span><span class="n">byte</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Byte &quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">byte</span><span class="p">),</span>
                <span class="s2">&quot;  -&quot;</span> <span class="s2">&quot;  Left Margin:  &quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">left_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="s2">&quot;)  Center Point:  &quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="s2">&quot;)  Right Margin:  &quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="s2">&quot; (&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">right_marg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="s2">&quot;)&quot;</span><span class="p">,</span>
            <span class="p">)</span>

<div class="viewcode-block" id="DDR.report"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run a report on the current statuses and analytical data of the DDRMC</span>

<span class="sd">        Args:</span>
<span class="sd">            to_file: specify True to have the report saved to a file</span>

<span class="sd">            file_name: the file name or full path for the report file to be saved</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">orig_out</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">to_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">file_name</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">NOTE: Need to specify a file name for the report output.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">NOTE: The report is being generated and saved as:&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
                <span class="n">orig_out</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">out_file</span>

        <span class="c1"># DDRMC Status &amp; Message</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; DDRMC Status </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_cal_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_health_status</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calibration Status:  &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cal_status</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;health_status&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Overall Health:  &quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;health_status&quot;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;cal_message&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Message:  &quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cal_message&quot;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Check if there is error condition to report</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;cal_error_msg&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cal_error_msg&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:  &quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cal_error_msg&quot;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># DDRMC ISR Registers</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Status Registers</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DDRMC ISR Table</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property_group</span><span class="p">([</span><span class="s2">&quot;ddrmc_isr_e&quot;</span><span class="p">,</span> <span class="s2">&quot;ddrmc_isr_w&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;:  &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">UB ISR Table</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property_group</span><span class="p">([</span><span class="s2">&quot;ub_isr_e&quot;</span><span class="p">,</span> <span class="s2">&quot;ub_isr_w&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;:  &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

        <span class="c1"># Memory configuration info</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">----------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Memory Configuration </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_configuration</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">configs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;:  &quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1"># Memory calibration stages info</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-----------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Calibration Stages Information </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Do not do calibration stages if a system error is detected</span>
        <span class="n">sys_error</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cal_status</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;SYSTEM ERROR&quot;</span><span class="p">:</span>
            <span class="n">sys_error</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sys_error</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cal_stages</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;:  &quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Note: DDRMC system error is detected. Calibration stages decoding will not be provided for &quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Cal Margin Analysis</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">---------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Calibration Window Margin Analysis </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sys_error</span><span class="p">:</span>
            <span class="n">cal_margin_modes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">left_margins</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">right_margins</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">center_points</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">is_by_8</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">num_byte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Bytes&quot;</span><span class="p">])</span>
            <span class="n">num_nibble</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Nibbles&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_cal_margin</span><span class="p">()</span>
            <span class="n">cal_margin_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cal_margin_mode</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">configs</span><span class="p">[</span><span class="s2">&quot;Bits per Byte&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">is_by_8</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Main loop to go through dual frequencies</span>
            <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;Frequency &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
                <span class="c1"># Read Simple</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_simp&quot;</span>
                <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                    <span class="c1"># Rising Edge</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                        <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_rise&quot;</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                    <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">base</span><span class="p">,</span>
                        <span class="s2">&quot; - Read Margin - Simple Pattern - Rising Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__output_read_margins</span><span class="p">(</span>
                        <span class="n">is_by_8</span><span class="p">,</span> <span class="n">num_byte</span><span class="p">,</span> <span class="n">num_nibble</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                    <span class="p">)</span>
                    <span class="c1"># Falling Edge</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                        <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_fall&quot;</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                    <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">base</span><span class="p">,</span>
                        <span class="s2">&quot; - Read Margin - Simple Pattern - Falling Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__output_read_margins</span><span class="p">(</span>
                        <span class="n">is_by_8</span><span class="p">,</span> <span class="n">num_byte</span><span class="p">,</span> <span class="n">num_nibble</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                    <span class="p">)</span>
                <span class="c1"># Read Complex</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_rd_comp&quot;</span>
                <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                    <span class="c1"># Rising Edge</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                        <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_rise&quot;</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                    <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">base</span><span class="p">,</span>
                        <span class="s2">&quot; - Read Margin - Complex Pattern - Rising Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__output_read_margins</span><span class="p">(</span>
                        <span class="n">is_by_8</span><span class="p">,</span> <span class="n">num_byte</span><span class="p">,</span> <span class="n">num_nibble</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                    <span class="p">)</span>
                    <span class="c1"># Falling Edge</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span>
                        <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_fall&quot;</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                    <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">base</span><span class="p">,</span>
                        <span class="s2">&quot; - Read Margin - Complex Pattern - Falling Edge Clock in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__output_read_margins</span><span class="p">(</span>
                        <span class="n">is_by_8</span><span class="p">,</span> <span class="n">num_byte</span><span class="p">,</span> <span class="n">num_nibble</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                    <span class="p">)</span>
                <span class="c1"># Write Simple</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_simp&quot;</span>
                <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">base</span><span class="p">,</span>
                        <span class="s2">&quot; - Write Margin - Simple Pattern - Calibration Window in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__output_write_margins</span><span class="p">(</span>
                        <span class="n">num_byte</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                    <span class="p">)</span>
                <span class="c1"># Write Complex</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_wr_comp&quot;</span>
                <span class="k">if</span> <span class="n">cal_margin_modes</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__get_cal_margins</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">base</span><span class="p">,</span>
                        <span class="s2">&quot; - Write Margin - Complex Pattern - Calibration Window in pS and (delay taps):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__output_write_margins</span><span class="p">(</span>
                        <span class="n">num_byte</span><span class="p">,</span> <span class="n">left_margins</span><span class="p">,</span> <span class="n">right_margins</span><span class="p">,</span> <span class="n">center_points</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Note: DDRMC system error is detected. Margin Analysis will not be provided for &quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">out_file</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">orig_out</span>
            <span class="n">out_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_read_mode"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.set_eye_scan_read_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_read_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan to read mode</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">commit_property_group</span><span class="p">([])</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_write_mode"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.set_eye_scan_write_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_write_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan to write mode</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">commit_property_group</span><span class="p">([])</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_simple_pattern"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.set_eye_scan_simple_pattern">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_simple_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan traffic pattern to simple mode</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;mgchk_pattern_mode&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">commit_property_group</span><span class="p">([])</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_complex_pattern"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.set_eye_scan_complex_pattern">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_complex_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan traffic pattern to complex mode</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;mgchk_pattern_mode&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">commit_property_group</span><span class="p">([])</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_rank"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.set_eye_scan_rank">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rank_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the target rank number on the DDR for 2D eye scan to run on.</span>
<span class="sd">        There will be 4 total possible rank selections. For single slot designs, there will be quad ranks.</span>
<span class="sd">        For dual slot designs, there will be dual ranks per slot.</span>
<span class="sd">        2D Margin Scan can only be performed on one rank at a time, and not in parallel.</span>

<span class="sd">        Args:</span>

<span class="sd">            rank_num:</span>
<span class="sd">                Rank number valid between 0 and 3 on the DDR for 2D Margin to be run on.</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rank_num</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Please enter an integer value from 0 to 3 for Slot/Rank selection.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">rank_num</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot enter a rank_num value larger than 3.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;mgchk_rank&quot;</span><span class="p">:</span> <span class="n">rank_num</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">commit_property_group</span><span class="p">([])</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="DDR.get_eye_scan_vref_percentage"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.get_eye_scan_vref_percentage">[docs]</a>    <span class="k">def</span> <span class="nf">get_eye_scan_vref_percentage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A user helper function that takes in an encoding vref value intended for the margin scan,</span>
<span class="sd">        and converts it into a percentage value based on the current scan mode</span>
<span class="sd">        and memory configuration detected from the current hardware.</span>

<span class="sd">        Args:</span>

<span class="sd">            vref:</span>
<span class="sd">                For Read mode, valid integer range between 0 to 1023</span>
<span class="sd">                For Write mode, valid integer range between 0 to 50</span>

<span class="sd">        Returns:</span>

<span class="sd">            A translated percentage number in floating point</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vref</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Please re-enter an integer value for Vref.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">vref</span> <span class="o">&gt;</span> <span class="mi">1023</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot enter VRef values larger than 1023&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">base_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">incr_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ddr4_range_one</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="n">ddr4_range_two</span> <span class="o">=</span> <span class="mi">45</span>
        <span class="n">lp4_range_one</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">lp4_range_two</span> <span class="o">=</span> <span class="mf">20.4</span>
        <span class="n">ddr4_incr_size</span> <span class="o">=</span> <span class="mf">0.65</span>
        <span class="n">lp4_incr_size</span> <span class="o">=</span> <span class="mf">0.4</span>
        <span class="n">read_incr_size</span> <span class="o">=</span> <span class="mf">0.0976563</span>
        <span class="n">prop_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">)</span>
        <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;mem_type&quot;</span><span class="p">)</span>
        <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;mgchk_def_wr_vref_range&quot;</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="n">prop_list</span><span class="p">)</span>
        <span class="n">rw_mode</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">]</span>
        <span class="n">mem_type</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mem_type&quot;</span><span class="p">]</span>
        <span class="n">write_vref_range</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mgchk_def_wr_vref_range&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rw_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vref</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot enter Vref values larger than 50 for Write Margin mode&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">mem_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">write_vref_range</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">base_value</span> <span class="o">=</span> <span class="n">ddr4_range_one</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">base_value</span> <span class="o">=</span> <span class="n">ddr4_range_two</span>
                <span class="n">incr_size</span> <span class="o">=</span> <span class="n">ddr4_incr_size</span>
            <span class="k">elif</span> <span class="n">mem_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">write_vref_range</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">base_value</span> <span class="o">=</span> <span class="n">lp4_range_one</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">base_value</span> <span class="o">=</span> <span class="n">lp4_range_two</span>
                <span class="n">incr_size</span> <span class="o">=</span> <span class="n">lp4_incr_size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">incr_size</span> <span class="o">=</span> <span class="n">read_incr_size</span>

        <span class="n">offset_value</span> <span class="o">=</span> <span class="n">vref</span> <span class="o">*</span> <span class="n">incr_size</span>
        <span class="n">output_vref</span> <span class="o">=</span> <span class="n">base_value</span> <span class="o">+</span> <span class="n">offset_value</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rw_mode</span><span class="p">:</span>
            <span class="n">output_vref</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">output_vref</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_vref</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">output_vref</span>

        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">output_vref</span><span class="p">)</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_vref_min"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.set_eye_scan_vref_min">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_vref_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan desired minimum vref value to scan</span>

<span class="sd">        Args:</span>

<span class="sd">            vref:</span>
<span class="sd">                For Read mode, valid integer range between 0 to 1023</span>
<span class="sd">                For Write mode, valid integer range between 0 to 50</span>

<span class="sd">        Returns:</span>

<span class="sd">            A translated percentage number in floating point if</span>
<span class="sd">            the input VRef is set successfully</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">percent_vref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eye_scan_vref_percentage</span><span class="p">(</span><span class="n">vref</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">percent_vref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vref</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vref</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;es_vref_min&quot;</span><span class="p">:</span> <span class="n">vref</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">percent_vref</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_vref_max"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.set_eye_scan_vref_max">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_vref_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan desired maximum vref value to scan</span>

<span class="sd">        Args:</span>

<span class="sd">            vref:</span>
<span class="sd">                For Read mode, valid integer range between 0 to 1023</span>
<span class="sd">                For Write mode, valid integer range between 0 to 50</span>

<span class="sd">        Returns:</span>

<span class="sd">            A translated percentage number in floating point if</span>
<span class="sd">            the input VRef is set successfully</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">percent_vref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eye_scan_vref_percentage</span><span class="p">(</span><span class="n">vref</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">percent_vref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vref</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vref</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;es_vref_max&quot;</span><span class="p">:</span> <span class="n">vref</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">percent_vref</span></div>

<div class="viewcode-block" id="DDR.set_eye_scan_vref_steps"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.set_eye_scan_vref_steps">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_scan_vref_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set 2D eye scan desired number of vref steps to scan vertically</span>

<span class="sd">        Args:</span>

<span class="sd">            steps:</span>
<span class="sd">                Valid integer range between 1 to 1024 for Read mode.</span>
<span class="sd">                Valid integer range between 1 to 51 for Write mode.</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">([</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">])</span>
        <span class="n">rw_mode</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Please re-enter an integer value for Vref steps.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">rw_mode</span> <span class="ow">and</span> <span class="p">(</span><span class="n">steps</span> <span class="o">&gt;</span> <span class="mi">51</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot enter Vref step sizes larger than 51 for Write Margin mode&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">steps</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot enter Vref step sizes larger than 1024 for Read Margin mode&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;es_vref_steps&quot;</span><span class="p">:</span> <span class="n">steps</span><span class="p">})</span>

        <span class="k">return</span></div>

    <span class="k">def</span> <span class="nf">__update_eye_scan_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
        <span class="n">clocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nqtr&quot;</span><span class="p">,</span> <span class="s2">&quot;pqtr&quot;</span><span class="p">]</span>
        <span class="n">clock_defs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;nqtr&quot;</span><span class="p">:</span> <span class="s2">&quot;fall_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pqtr&quot;</span><span class="p">:</span> <span class="s2">&quot;rise_&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">engine_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_eye_scan_data</span><span class="p">()</span>
        <span class="n">ps_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_margin_ps_factors</span><span class="p">()</span>
        <span class="n">data_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">engine_data</span><span class="p">)</span>

        <span class="c1"># If initial vref scan went wrong after enabled, needless to process data further</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">scan_mode</span> <span class="o">=</span> <span class="n">engine_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.mode&quot;</span><span class="p">]</span>
        <span class="n">nibble_count</span> <span class="o">=</span> <span class="n">engine_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.nibbles&quot;</span><span class="p">]</span>
        <span class="n">byte_count</span> <span class="o">=</span> <span class="n">engine_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.bytes&quot;</span><span class="p">]</span>
        <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">engine_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="s2">&quot;Read&quot;</span> <span class="ow">in</span> <span class="n">scan_mode</span><span class="p">:</span>
            <span class="n">old_key_base</span> <span class="o">=</span> <span class="s2">&quot;rdmargin_&quot;</span>
            <span class="n">new_key_base</span> <span class="o">=</span> <span class="s2">&quot;read_&quot;</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">engine_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">for</span> <span class="n">nibble</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nibble_count</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">clock</span> <span class="ow">in</span> <span class="n">clocks</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                            <span class="n">old_key</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">old_key_base</span>
                                <span class="o">+</span> <span class="n">clock</span>
                                <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
                                <span class="o">+</span> <span class="n">edge</span>
                                <span class="o">+</span> <span class="s2">&quot;_nibble&quot;</span>
                                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nibble</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="n">ps_name</span> <span class="o">=</span> <span class="n">new_key_base</span> <span class="o">+</span> <span class="n">clock_defs</span><span class="p">[</span><span class="n">clock</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nibble</span><span class="p">)</span>
                            <span class="n">new_key</span> <span class="o">=</span> <span class="n">ps_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">edge</span>
                            <span class="n">new_key_ps</span> <span class="o">=</span> <span class="n">new_key</span> <span class="o">+</span> <span class="s2">&quot;_ps&quot;</span>
                            <span class="n">ps_factor</span> <span class="o">=</span> <span class="n">ps_factors</span><span class="p">[</span><span class="n">ps_name</span><span class="p">]</span>
                            <span class="n">tap_value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">old_key</span><span class="p">]</span>
                            <span class="n">ps_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tap_value</span> <span class="o">*</span> <span class="n">ps_factor</span><span class="p">))</span>
                            <span class="n">data</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tap_value</span>
                            <span class="n">data</span><span class="p">[</span><span class="n">new_key_ps</span><span class="p">]</span> <span class="o">=</span> <span class="n">ps_value</span>
                            <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="n">old_key</span><span class="p">]</span>
                <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;wrmargin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">}</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">temp_data</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
                <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">old_key_base</span> <span class="o">=</span> <span class="s2">&quot;wrmargin_&quot;</span>
            <span class="n">new_key_base</span> <span class="o">=</span> <span class="s2">&quot;write_&quot;</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">engine_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">byte_count</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                        <span class="n">old_key</span> <span class="o">=</span> <span class="n">old_key_base</span> <span class="o">+</span> <span class="n">edge</span> <span class="o">+</span> <span class="s2">&quot;_byte&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
                        <span class="n">ps_name</span> <span class="o">=</span> <span class="n">new_key_base</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
                        <span class="n">new_key</span> <span class="o">=</span> <span class="n">ps_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">edge</span>
                        <span class="n">new_key_ps</span> <span class="o">=</span> <span class="n">new_key</span> <span class="o">+</span> <span class="s2">&quot;_ps&quot;</span>
                        <span class="n">ps_factor</span> <span class="o">=</span> <span class="n">ps_factors</span><span class="p">[</span><span class="n">ps_name</span><span class="p">]</span>
                        <span class="n">tap_value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">old_key</span><span class="p">]</span>
                        <span class="n">ps_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tap_value</span> <span class="o">*</span> <span class="n">ps_factor</span><span class="p">))</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tap_value</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">new_key_ps</span><span class="p">]</span> <span class="o">=</span> <span class="n">ps_value</span>
                        <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="n">old_key</span><span class="p">]</span>
                <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;rdmargin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">}</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">temp_data</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
                <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span> <span class="o">=</span> <span class="n">data_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;es_data_need_update&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">__draw_eye_scan_graph</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">margin_data</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">base_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">margin_title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">def_vref</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">):</span>
        <span class="n">vrefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">left_margs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">right_margs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">left_ps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">right_ps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">margin_data</span><span class="p">:</span>
            <span class="n">vrefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;config.vrefp&quot;</span><span class="p">]))</span>
            <span class="n">key_name</span> <span class="o">=</span> <span class="n">base_name</span> <span class="o">+</span> <span class="s2">&quot;_left&quot;</span>
            <span class="n">left_margs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">]))</span>
            <span class="n">key_name</span> <span class="o">+=</span> <span class="s2">&quot;_ps&quot;</span>
            <span class="n">left_ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">]))</span>
            <span class="n">key_name</span> <span class="o">=</span> <span class="n">base_name</span> <span class="o">+</span> <span class="s2">&quot;_right&quot;</span>
            <span class="n">right_margs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">]))</span>
            <span class="n">key_name</span> <span class="o">+=</span> <span class="s2">&quot;_ps&quot;</span>
            <span class="n">right_ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key_name</span><span class="p">]))</span>

        <span class="n">x_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">left_ps</span><span class="p">)</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">right_ps</span><span class="p">)</span>

        <span class="n">data_defs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;VRef&quot;</span><span class="p">:</span> <span class="n">vrefs</span><span class="p">,</span>
            <span class="s2">&quot;Left_Margin&quot;</span><span class="p">:</span> <span class="n">left_margs</span><span class="p">,</span>
            <span class="s2">&quot;Right_Margin&quot;</span><span class="p">:</span> <span class="n">right_margs</span><span class="p">,</span>
            <span class="s2">&quot;Left_PS&quot;</span><span class="p">:</span> <span class="n">left_ps</span><span class="p">,</span>
            <span class="s2">&quot;Right_PS&quot;</span><span class="p">:</span> <span class="n">right_ps</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_defs</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">df_left</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="n">ps_left</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
            <span class="n">data_left</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_left</span><span class="p">,</span> <span class="n">ps_left</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=-</span><span class="n">ps_left</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                    <span class="n">customdata</span><span class="o">=</span><span class="n">data_left</span><span class="p">,</span>
                    <span class="n">marker_color</span><span class="o">=</span><span class="s2">&quot;#75ad0a&quot;</span><span class="p">,</span>
                    <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;Taps: %</span><span class="si">{customdata[0]}</span><span class="s2"> &lt;br&gt;pS: %</span><span class="si">{customdata[1]}</span><span class="s2"> &lt;br&gt;VRef: %</span><span class="si">{y}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]:</span>
            <span class="n">df_right</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="n">ps_right</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
            <span class="n">data_right</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_right</span><span class="p">,</span> <span class="n">ps_right</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">ps_right</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                    <span class="n">customdata</span><span class="o">=</span><span class="n">data_right</span><span class="p">,</span>
                    <span class="n">marker_color</span><span class="o">=</span><span class="s2">&quot;#0073e6&quot;</span><span class="p">,</span>
                    <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;Taps: %</span><span class="si">{customdata[0]}</span><span class="s2"> &lt;br&gt;pS: %</span><span class="si">{customdata[1]}</span><span class="s2"> &lt;br&gt;VRef: %</span><span class="si">{y}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">],</span>
                <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">def_vref</span><span class="p">,</span> <span class="n">def_vref</span><span class="p">],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#92b1a9&quot;</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;DDRMC VRef: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">def_vref</span><span class="p">),</span>
                <span class="n">customdata</span><span class="o">=</span><span class="p">[</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">],</span>
                <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;%</span><span class="si">{customdata}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">barmode</span><span class="o">=</span><span class="s2">&quot;relative&quot;</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
            <span class="n">bargap</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s2">&quot;#0f263e&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">margin_title</span><span class="p">,</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Delay in pS&quot;</span><span class="p">),</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;VRef Percentage&quot;</span><span class="p">),</span>
            <span class="n">legend_orientation</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>
            <span class="n">legend_x</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">legend_y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>

<div class="viewcode-block" id="DDR.save_eye_scan_data"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.save_eye_scan_data">[docs]</a>    <span class="k">def</span> <span class="nf">save_eye_scan_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the eye scan 2D margin data from the most recent run to a file in CSV format</span>

<span class="sd">        Args:</span>

<span class="sd">            file_name: the file name or full path for the data file to be saved.</span>
<span class="sd">                       A default file name will be given if none is supplied.</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out_file</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_name</span><span class="p">:</span>
            <span class="c1"># Gives a default for users</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;eye_scan_data&quot;</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_eye_scan_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: No scan data is found. Please re-run 2D eye scan.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">data_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">more_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">more_keys</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_file</span><span class="p">:</span>
            <span class="n">data_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>
            <span class="n">data_writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="n">data_writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data are being formatted and saved to:&quot;</span><span class="p">,</span> <span class="n">out_file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="DDR.load_eye_scan_data"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.load_eye_scan_data">[docs]</a>    <span class="k">def</span> <span class="nf">load_eye_scan_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the eye scan 2D margin data from a data file</span>

<span class="sd">        Args:</span>

<span class="sd">            file_name: the file name or full path for the data file to be read and load</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="n">file_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
            <span class="n">data_reader</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_reader</span><span class="p">:</span>
                <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span> <span class="o">=</span> <span class="n">data_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">set_property</span><span class="p">({</span><span class="s2">&quot;es_data_need_update&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span></div>

<div class="viewcode-block" id="DDR.run_eye_scan"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.run_eye_scan">[docs]</a>    <span class="k">def</span> <span class="nf">run_eye_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">done</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">DoneFutureCallback</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">CsFuture</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kick off a run on 2D margin analysis and prepare scan data which is needed to draw an</span>
<span class="sd">        eye scan graph. The default scan settings will be used if users have not configured with</span>
<span class="sd">        new settings. See the following related commands for more info:</span>

<span class="sd">            save_eye_scan_data()</span>
<span class="sd">            load_eye_scan_data()</span>
<span class="sd">            display_eye_scan()</span>

<span class="sd">        Args:</span>
<span class="sd">            done: Optional command callback that will be invoked when the scan is finished</span>

<span class="sd">        Returns:</span>
<span class="sd">            Boolean value indicating success of the 2D margin scan</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Perform some logical data check on user settings</span>
        <span class="n">prop_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">)</span>
        <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;es_vref_min&quot;</span><span class="p">)</span>
        <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;es_vref_max&quot;</span><span class="p">)</span>
        <span class="n">prop_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;es_vref_steps&quot;</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="n">prop_list</span><span class="p">)</span>
        <span class="n">rw_mode</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mgchk_rw_mode&quot;</span><span class="p">]</span>
        <span class="n">vref_min</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;es_vref_min&quot;</span><span class="p">]</span>
        <span class="n">vref_max</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;es_vref_max&quot;</span><span class="p">]</span>
        <span class="n">vref_steps</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;es_vref_steps&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rw_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">vref_min</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">vref_max</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot set Vref values larger than 50 under Write margin mode.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">vref_steps</span> <span class="o">&gt;</span> <span class="mi">51</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot set Vref step sizes larger than 51 for Write Margin mode&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">vref_min</span> <span class="o">&gt;</span> <span class="n">vref_max</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot set minimum Vref value larger than maximum Vref value.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">percent_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eye_scan_vref_percentage</span><span class="p">(</span><span class="n">vref_min</span><span class="p">)</span>
        <span class="n">percent_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eye_scan_vref_percentage</span><span class="p">(</span><span class="n">vref_max</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min VRef is set at: &quot;</span><span class="p">,</span> <span class="n">percent_min</span><span class="p">,</span> <span class="s2">&quot;%, value &quot;</span><span class="p">,</span> <span class="n">vref_min</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max VRef is set at: &quot;</span><span class="p">,</span> <span class="n">percent_max</span><span class="p">,</span> <span class="s2">&quot;%, value &quot;</span><span class="p">,</span> <span class="n">vref_max</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of VRef steps is set at: &quot;</span><span class="p">,</span> <span class="n">vref_steps</span><span class="p">)</span>

        <span class="n">vref_incr_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">vref_max</span> <span class="o">-</span> <span class="n">vref_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">vref_steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">max_step_size</span> <span class="o">=</span> <span class="n">vref_max</span> <span class="o">-</span> <span class="n">vref_min</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">vref_incr_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;ERROR: For the selected VRef Min and VRef Max, the maximum step size is: &quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">max_step_size</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Please either reduce the VRef steps or increase the VRef range by adjusting Min/Max.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">scan_future</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">CsFutureSync</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>

        <span class="c1"># Institute a Progress Bar</span>
        <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">PercentProgressBar</span><span class="p">()</span>
        <span class="n">progress_bar</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;2D Margin Scan Progress&quot;</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">PercentProgressBar</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">STARTING</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">progress_update</span><span class="p">(</span><span class="n">future</span><span class="p">):</span>
            <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">completed</span><span class="o">=</span><span class="n">future</span><span class="o">.</span><span class="n">progress</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">PercentProgressBar</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IN_PROGRESS</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">done_scan</span><span class="p">(</span><span class="n">future</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">future</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">PercentProgressBar</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">ABORTED</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">completed</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">PercentProgressBar</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">DONE</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">future</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                <span class="n">scan_future</span><span class="o">.</span><span class="n">set_exception</span><span class="p">(</span><span class="n">future</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scan_future</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="n">future</span><span class="p">):</span>
            <span class="c1"># Call on main thread for any final processing desired</span>
            <span class="n">result_list</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">_result</span>
            <span class="k">if</span> <span class="n">result_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="c1"># Can think about if want to provide auto-draw or</span>
                <span class="c1"># auto-save log for the users</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;COMPLETED&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2D margin scan run status is: &quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">future</span><span class="p">(</span>
            <span class="n">progress</span><span class="o">=</span><span class="n">progress_update</span><span class="p">,</span> <span class="n">done</span><span class="o">=</span><span class="n">done_scan</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="n">finalize</span>
        <span class="p">)</span><span class="o">.</span><span class="n">run_eye_scan_async</span><span class="p">(</span><span class="n">data_checked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info: Margin Scans in progress...&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">scan_future</span> <span class="k">if</span> <span class="n">done</span> <span class="k">else</span> <span class="n">scan_future</span><span class="o">.</span><span class="n">result</span></div>

<div class="viewcode-block" id="DDR.display_eye_scan"><a class="viewcode-back" href="../../../ddr.html#chipscopy.api.ddr.DDR.display_eye_scan">[docs]</a>    <span class="k">def</span> <span class="nf">display_eye_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">return_as_list</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assemble and display 2D eye scan drawing in chart format. By default it tries to process and</span>
<span class="sd">        draw from the scan data found in the most recent 2D eye scan run. Users have the option to</span>
<span class="sd">        load scan data first prior to using this function in order to display specific set of scan</span>
<span class="sd">        data, see load_eye_scan_data().</span>

<span class="sd">        By default, if no unit_index is specified, unit zero from the scan data will be displayed.</span>
<span class="sd">        For read margins, both rising and falling edge clock scan data will be processed and displayed.</span>

<span class="sd">        Args:</span>
<span class="sd">            unit_index: Specify the index from a set of scan data users intend to display, based on</span>
<span class="sd">                unit mode found in the scan settings (bit, nibble, byte)</span>

<span class="sd">            return_as_list: Optional argument, default to False. If set to True, the function will</span>
<span class="sd">                not display graphs by default. Instead, it returns a list of the grapghing objects</span>
<span class="sd">                back to the caller.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Figure object from Plotly, if return_as_list is specified as True,</span>
<span class="sd">            None is return otherwise by default.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_plotting_pkgs_available</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Plotting packages not installed! Please run &quot;</span><span class="p">,</span>
                <span class="s2">&quot;&#39;pip install chipscopy[plotly,pandas]&#39;&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr_node</span><span class="o">.</span><span class="n">get_property</span><span class="p">([</span><span class="s2">&quot;es_data_need_update&quot;</span><span class="p">])</span>
        <span class="n">data_need_update</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;es_data_need_update&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">data_need_update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_eye_scan_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;ERROR: No scan data is found. Please re-run 2D eye scan, &quot;</span>
                <span class="s2">&quot;or load scan data first from a data file.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit_index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Please re-enter an integer value for unit_index.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">figure_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_scan_data</span>
        <span class="n">scan_mode</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.mode&quot;</span><span class="p">]</span>
        <span class="n">unit_mode</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.unit&quot;</span><span class="p">]</span>
        <span class="n">rank_num</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.rank&quot;</span><span class="p">]</span>
        <span class="n">mem_type</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.mem_type&quot;</span><span class="p">]</span>
        <span class="n">df_vref</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.df_vrefp&quot;</span><span class="p">]</span>
        <span class="n">df_vref</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df_vref</span><span class="p">)</span>
        <span class="n">nibble_count</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.nibbles&quot;</span><span class="p">]</span>
        <span class="n">byte_count</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;config.bytes&quot;</span><span class="p">]</span>
        <span class="n">unit_val</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit_index</span><span class="p">)</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># Some logical data check first on user inputs</span>
        <span class="k">if</span> <span class="n">unit_mode</span> <span class="o">==</span> <span class="s2">&quot;nibble&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">unit_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">unit_index</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nibble_count</span><span class="p">)):</span>
                <span class="n">max_unit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nibble_count</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;ERROR: unit_index given for &quot;</span>
                    <span class="o">+</span> <span class="n">unit_mode</span>
                    <span class="o">+</span> <span class="s2">&quot; mode needs to be between 0 and &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_unit</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">err_msg</span> <span class="o">+=</span> <span class="s2">&quot;, based on current memory configuration.&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">elif</span> <span class="n">unit_mode</span> <span class="o">==</span> <span class="s2">&quot;byte&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">unit_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">unit_index</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">byte_count</span><span class="p">)):</span>
                <span class="n">max_unit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">byte_count</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;ERROR: unit_index given for &quot;</span>
                    <span class="o">+</span> <span class="n">unit_mode</span>
                    <span class="o">+</span> <span class="s2">&quot; mode needs to be between 0 and &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_unit</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">err_msg</span> <span class="o">+=</span> <span class="s2">&quot;, based on current memory configuration.&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="s2">&quot;Read&quot;</span> <span class="ow">in</span> <span class="n">scan_mode</span><span class="p">:</span>
            <span class="n">clocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rise_&quot;</span><span class="p">,</span> <span class="s2">&quot;fall_&quot;</span><span class="p">]</span>
            <span class="n">clock_defs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;rise_&quot;</span><span class="p">:</span> <span class="s2">&quot; - Rising Edge Clock - &quot;</span><span class="p">,</span>
                <span class="s2">&quot;fall_&quot;</span><span class="p">:</span> <span class="s2">&quot; - Falling Edge Clock - &quot;</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="k">for</span> <span class="n">clock</span> <span class="ow">in</span> <span class="n">clocks</span><span class="p">:</span>
                <span class="n">name_base</span> <span class="o">=</span> <span class="s2">&quot;read_&quot;</span> <span class="o">+</span> <span class="n">clock</span> <span class="o">+</span> <span class="n">unit_val</span>
                <span class="n">margin_mode</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">scan_mode</span>
                    <span class="o">+</span> <span class="n">clock_defs</span><span class="p">[</span><span class="n">clock</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">unit_mode</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">unit_index</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;&lt;br&gt;&quot;</span>
                <span class="p">)</span>
                <span class="n">margin_mode</span> <span class="o">+=</span> <span class="n">mem_type</span> <span class="o">+</span> <span class="s2">&quot; - Rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank_num</span><span class="p">)</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__draw_eye_scan_graph</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">name_base</span><span class="p">,</span> <span class="n">margin_mode</span><span class="p">,</span> <span class="n">df_vref</span><span class="p">)</span>
                <span class="n">figure_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name_base</span> <span class="o">=</span> <span class="s2">&quot;write_&quot;</span> <span class="o">+</span> <span class="n">unit_val</span>
            <span class="n">margin_mode</span> <span class="o">=</span> <span class="n">scan_mode</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">unit_mode</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">unit_index</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;br&gt;&quot;</span>
            <span class="n">margin_mode</span> <span class="o">+=</span> <span class="n">mem_type</span> <span class="o">+</span> <span class="s2">&quot; - Rank&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rank_num</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__draw_eye_scan_graph</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">name_base</span><span class="p">,</span> <span class="n">margin_mode</span><span class="p">,</span> <span class="n">df_vref</span><span class="p">)</span>
            <span class="n">figure_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_as_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figure_list</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">figure_list</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on June 30, 2021.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2021, Xilinx
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>